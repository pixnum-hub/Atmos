<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Atmos â€” Weather &amp; Air Quality</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --accent: #38bdf8;
  --accent2: #818cf8;
  --rain: #38bdf8;
  --radius-card: 18px;
  --radius-sm: 10px;
  --font-body: 'Inter', system-ui, sans-serif;
  --font-display: 'Nunito', system-ui, sans-serif;
  --transition: 0.25s ease;
}

/* DARK (default) */
[data-theme="dark"] {
  --bg: #0a0f1e;
  --bg2: #0d1830;
  --card: rgba(255,255,255,0.045);
  --card-solid: #111827;
  --border: rgba(255,255,255,0.09);
  --text: #e8edf5;
  --text2: #94a3b8;
  --text3: #64748b;
  --shadow: 0 4px 24px rgba(0,0,0,0.4);
  --glow: rgba(56,189,248,0.07);
  --glow2: rgba(129,140,248,0.06);
}

/* LIGHT */
[data-theme="light"] {
  --bg: #f0f4fb;
  --bg2: #e4eaf5;
  --card: rgba(255,255,255,0.85);
  --card-solid: #ffffff;
  --border: rgba(0,0,0,0.08);
  --text: #0f172a;
  --text2: #475569;
  --text3: #94a3b8;
  --shadow: 0 4px 24px rgba(0,0,0,0.10);
  --glow: rgba(56,189,248,0.10);
  --glow2: rgba(129,140,248,0.08);
  --accent: #0284c7;
  --accent2: #6366f1;
  --rain: #0284c7;
}

/* OLED TRUE BLACK */
[data-theme="oled"] {
  --bg: #000000;
  --bg2: #0a0a0a;
  --card: rgba(255,255,255,0.03);
  --card-solid: #0d0d0d;
  --border: rgba(255,255,255,0.07);
  --text: #f1f5f9;
  --text2: #94a3b8;
  --text3: #475569;
  --shadow: 0 4px 32px rgba(0,0,0,0.8);
  --glow: rgba(56,189,248,0.05);
  --glow2: rgba(129,140,248,0.04);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

html { font-size: 17px; } /* Elder-friendly base */

body {
  font-family: var(--font-body);
  font-size: 1rem;
  line-height: 1.6;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  transition: background var(--transition), color var(--transition);
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background:
    radial-gradient(ellipse 80% 50% at 20% 20%, var(--glow) 0%, transparent 60%),
    radial-gradient(ellipse 60% 40% at 80% 80%, var(--glow2) 0%, transparent 60%);
  pointer-events: none; z-index: 0;
  transition: background var(--transition);
}

.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 1.75rem 1.5rem;
  position: relative; z-index: 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.75rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.logo {
  font-family: var(--font-display);
  font-size: 2rem;
  font-weight: 900;
  letter-spacing: -0.03em;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.logo span { font-weight: 600; opacity: 0.55; }

.header-right {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}

/* Theme toggle */
.theme-toggle {
  display: flex;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 100px;
  padding: 3px;
  gap: 2px;
}
.theme-btn {
  background: none;
  border: none;
  color: var(--text3);
  padding: 0.38rem 0.75rem;
  border-radius: 100px;
  cursor: pointer;
  font-size: 0.78rem;
  font-family: var(--font-body);
  font-weight: 600;
  letter-spacing: 0.01em;
  transition: all 0.2s;
  display: flex; align-items: center; gap: 0.3rem;
}
.theme-btn.active {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff;
  box-shadow: 0 2px 8px rgba(56,189,248,0.3);
}
.theme-btn:not(.active):hover { color: var(--text); background: var(--border); }

/* Search */
.search-bar { display: flex; gap: 0.5rem; flex: 1; max-width: 420px; }
.search-bar input {
  flex: 1;
  background: var(--card);
  border: 2px solid var(--border);
  color: var(--text);
  padding: 0.75rem 1.1rem;
  border-radius: var(--radius-sm);
  font-family: var(--font-body);
  font-size: 1rem;
  font-weight: 500;
  outline: none;
  transition: border-color 0.2s, background 0.2s;
}
.search-bar input:focus { border-color: var(--accent); }
.search-bar input::placeholder { color: var(--text3); }
.search-bar button, .locate-btn {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border: none; color: #fff;
  padding: 0.75rem 1.1rem;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 1rem;
  font-weight: 700;
  transition: opacity 0.2s, transform 0.1s;
}
.search-bar button:hover, .locate-btn:hover { opacity: 0.85; transform: translateY(-1px); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATUS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.status-msg { text-align: center; color: var(--text2); font-size: 1.05rem; padding: 4rem 0; display: none; }
.status-msg.visible { display: block; }
.loader {
  display: inline-block; width: 20px; height: 20px;
  border: 2.5px solid var(--border); border-top-color: var(--accent);
  border-radius: 50%; animation: spin 0.8s linear infinite;
  vertical-align: middle; margin-right: 0.5rem;
}
@keyframes spin { to { transform: rotate(360deg); } }

#app { display: none; }
#app.visible { display: block; animation: fadeUp 0.5s ease; }
@keyframes fadeUp { from { opacity:0; transform:translateY(18px); } to { opacity:1; transform:translateY(0); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-card);
  padding: 1.75rem;
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  position: relative; overflow: hidden;
  box-shadow: var(--shadow);
  transition: background var(--transition), border-color var(--transition), box-shadow var(--transition);
}
.card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
}
[data-theme="light"] .card::before { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
@media(max-width:700px) { .hero { grid-template-columns: 1fr; } }

/* Current weather */
.location-name {
  font-family: var(--font-display);
  font-size: 1.5rem;
  font-weight: 800;
  margin-bottom: 0.2rem;
  color: var(--text);
}
.location-time {
  color: var(--text2);
  font-size: 0.88rem;
  font-weight: 500;
  margin-bottom: 1.35rem;
}
.temp-row { display: flex; align-items: flex-end; gap: 0.75rem; margin-bottom: 0.4rem; }
.temp-big {
  font-family: var(--font-display);
  font-size: 5.5rem;
  font-weight: 900;
  line-height: 1;
  letter-spacing: -0.04em;
  background: linear-gradient(135deg, var(--text), var(--accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.weather-icon { font-size: 3.2rem; line-height: 1; }
.weather-desc {
  color: var(--text2);
  font-size: 0.88rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  margin-bottom: 1.25rem;
}
.meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.65rem; }
.meta-item {
  background: rgba(255,255,255,0.04);
  border-radius: var(--radius-sm);
  padding: 0.65rem 0.9rem;
  border: 1px solid var(--border);
  transition: background var(--transition);
}
[data-theme="light"] .meta-item { background: rgba(0,0,0,0.04); }
.meta-label {
  font-size: 0.72rem;
  font-weight: 700;
  color: var(--text3);
  text-transform: uppercase;
  letter-spacing: 0.09em;
}
.meta-value {
  font-size: 1.05rem;
  font-weight: 700;
  margin-top: 0.12rem;
  color: var(--text);
}

/* AQI card */
.aqi-title {
  font-family: var(--font-display);
  font-size: 0.78rem;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 0.14em;
  color: var(--text2);
  margin-bottom: 0.35rem;
}
.aqi-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.1rem; }
.aqi-value {
  font-family: var(--font-display);
  font-size: 4.5rem;
  font-weight: 900;
  line-height: 1;
  letter-spacing: -0.04em;
}
.aqi-label {
  font-size: 0.72rem;
  font-weight: 800;
  padding: 0.25rem 0.8rem;
  border-radius: 100px;
  display: inline-block;
  margin-top: 0.4rem;
  text-transform: uppercase;
  letter-spacing: 0.07em;
}
.aqi-bar-wrap { margin: 1rem 0; }
.aqi-bar-track {
  height: 9px; border-radius: 5px;
  background: linear-gradient(90deg,#34d399,#fbbf24,#f97316,#ef4444,#a855f7,#7f1d1d);
  position: relative; margin-bottom: 0.4rem;
}
.aqi-bar-thumb {
  position: absolute; top: 50%; transform: translate(-50%,-50%);
  width: 15px; height: 15px; border-radius: 50%;
  background: #fff; box-shadow: 0 0 0 3px rgba(255,255,255,0.35);
  transition: left 0.9s cubic-bezier(0.34,1.56,0.64,1);
}
.aqi-bar-labels { display: flex; justify-content: space-between; font-size: 0.65rem; font-weight: 600; color: var(--text3); }
.poll-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem; margin-top: 0.9rem; }
.poll-item {
  background: rgba(255,255,255,0.035);
  border-radius: var(--radius-sm);
  padding: 0.6rem 0.8rem;
  border: 1px solid var(--border);
}
[data-theme="light"] .poll-item { background: rgba(0,0,0,0.035); }
.poll-name { font-size: 0.68rem; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.07em; }
.poll-val { font-size: 0.95rem; font-weight: 700; margin-top: 0.12rem; color: var(--text); }
.poll-bar-mini { height: 3px; border-radius: 2px; margin-top: 0.38rem; background: var(--border); position: relative; overflow: hidden; }
.poll-bar-fill { position: absolute; left:0; top:0; bottom:0; border-radius: 2px; background: linear-gradient(90deg,var(--accent),var(--accent2)); transition: width 0.9s ease; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION TITLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section-title {
  font-family: var(--font-display);
  font-size: 0.78rem;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 0.16em;
  color: var(--text2);
  margin-bottom: 0.9rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RAIN SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rain-summary-row {
  display: grid;
  grid-template-columns: repeat(5,1fr);
  gap: 0.8rem;
  margin-bottom: 1.5rem;
}
@media(max-width:800px){ .rain-summary-row { grid-template-columns: repeat(3,1fr); } }
@media(max-width:500px){ .rain-summary-row { grid-template-columns: repeat(2,1fr); } }
.rain-stat {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-card);
  padding: 1.1rem;
  backdrop-filter: blur(8px);
  box-shadow: var(--shadow);
  transition: background var(--transition), border-color var(--transition);
}
.rs-label { font-size: 0.7rem; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.09em; margin-bottom: 0.3rem; }
.rs-val { font-family: var(--font-display); font-size: 1.55rem; font-weight: 900; color: var(--rain); }
.rs-unit { font-size: 0.72rem; color: var(--text2); font-weight: 500; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIFESTYLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.lifestyle-grid {
  display: grid;
  grid-template-columns: repeat(3,1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}
@media(max-width:700px){ .lifestyle-grid { grid-template-columns: repeat(2,1fr); } }
@media(max-width:400px){ .lifestyle-grid { grid-template-columns: 1fr; } }
.lifestyle-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-card);
  padding: 1.2rem;
  backdrop-filter: blur(8px);
  display: flex; flex-direction: column; gap: 0.38rem;
  box-shadow: var(--shadow);
  transition: background var(--transition), border-color var(--transition), transform 0.2s;
}
.lifestyle-card:hover { transform: translateY(-2px); }
.lf-icon { font-size: 1.75rem; }
.lf-label { font-size: 0.7rem; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.09em; }
.lf-value { font-family: var(--font-display); font-size: 1.02rem; font-weight: 800; color: var(--text); }
.lf-sub { font-size: 0.8rem; font-weight: 500; color: var(--text2); line-height: 1.45; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   7-DAY FORECAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.forecast-row {
  display: grid;
  grid-template-columns: repeat(7,1fr);
  gap: 0.7rem;
  margin-bottom: 1.5rem;
}
@media(max-width:700px){ .forecast-row { grid-template-columns: repeat(4,1fr); } }
@media(max-width:450px){ .forecast-row { grid-template-columns: repeat(3,1fr); } }
.forecast-day {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-card);
  padding: 0.9rem 0.4rem;
  text-align: center;
  backdrop-filter: blur(8px);
  transition: border-color 0.2s, transform 0.2s, background var(--transition);
  cursor: default;
  box-shadow: var(--shadow);
}
.forecast-day:hover { border-color: rgba(56,189,248,0.45); transform: translateY(-3px); }
.forecast-day.today { border-color: rgba(56,189,248,0.35); background: rgba(56,189,248,0.07); }
.fc-day { font-size: 0.7rem; font-weight: 800; color: var(--text2); text-transform: uppercase; letter-spacing: 0.09em; margin-bottom: 0.38rem; }
.fc-icon { font-size: 1.6rem; margin-bottom: 0.32rem; }
.fc-hi { font-family: var(--font-display); font-weight: 800; font-size: 1rem; color: var(--text); }
.fc-lo { font-size: 0.8rem; font-weight: 600; color: var(--text2); }
.fc-rain { font-size: 0.68rem; font-weight: 700; color: var(--rain); margin-top: 0.3rem; }
.fc-aqi-dot { width: 9px; height: 9px; border-radius: 50%; margin: 0.32rem auto 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   24H HOURLY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hourly-scroll {
  display: flex; gap: 0.7rem;
  overflow-x: auto; padding-bottom: 0.75rem;
  scrollbar-width: thin;
  scrollbar-color: var(--border) transparent;
  margin-bottom: 1.5rem;
}
.hourly-item {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-card);
  padding: 0.75rem 0.9rem;
  text-align: center; flex-shrink: 0; min-width: 72px;
  backdrop-filter: blur(8px);
  box-shadow: var(--shadow);
  transition: background var(--transition);
}
.hr-time { font-size: 0.7rem; font-weight: 700; color: var(--text2); margin-bottom: 0.32rem; }
.hr-icon { font-size: 1.35rem; margin-bottom: 0.25rem; }
.hr-temp { font-family: var(--font-display); font-size: 0.95rem; font-weight: 800; color: var(--text); }
.hr-rain { font-size: 0.68rem; font-weight: 600; color: var(--rain); margin-top: 0.2rem; }
.hr-aqi { font-size: 0.68rem; margin-top: 0.18rem; font-weight: 800; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tab-row { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
.tab-btn {
  background: var(--card);
  border: 1px solid var(--border);
  color: var(--text2);
  padding: 0.45rem 1rem;
  border-radius: 100px;
  font-family: var(--font-body);
  font-size: 0.82rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
}
.tab-btn.active {
  background: rgba(56,189,248,0.14);
  border-color: rgba(56,189,248,0.5);
  color: var(--accent);
}
.tab-btn:not(.active):hover { color: var(--text); background: var(--border); }

.chart-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-card);
  padding: 1.5rem;
  backdrop-filter: blur(8px);
  margin-bottom: 1.5rem;
  box-shadow: var(--shadow);
  transition: background var(--transition);
}
.chart-wrap { overflow-x: auto; }
.bar-chart { display: flex; align-items: flex-end; gap: 4px; height: 110px; min-width: 580px; }
.bar-col { display: flex; flex-direction: column; align-items: center; flex: 1; gap: 4px; }
.bar-fill { width: 100%; border-radius: 4px 4px 0 0; min-height: 3px; transition: height 0.6s ease; }
.bar-label { font-size: 0.58rem; font-weight: 600; color: var(--text3); white-space: nowrap; }
.bar-val { font-size: 0.62rem; font-weight: 700; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.foot {
  text-align: center;
  color: var(--text3);
  font-size: 0.85rem;
  font-weight: 500;
  margin-top: 2.5rem;
  padding: 1.5rem 0 1rem;
  border-top: 1px solid var(--border);
  line-height: 1.7;
}
.foot strong {
  font-family: var(--font-display);
  font-weight: 800;
  color: var(--text2);
}
.foot a {
  color: var(--accent);
  text-decoration: none;
  font-weight: 600;
}
.foot a:hover { text-decoration: underline; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MISC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.error { color: #ef4444; font-weight: 600; }
.demo-banner {
  background: rgba(251,191,36,0.10);
  border: 1px solid rgba(251,191,36,0.3);
  border-radius: var(--radius-sm);
  padding: 0.7rem 1.1rem;
  font-size: 0.85rem;
  font-weight: 600;
  color: #d97706;
  text-align: center;
  margin-bottom: 1.35rem;
}
</style>
</head>
<body>
<div class="container">

  <!-- HEADER -->
  <header>
    <div class="logo">Atmos<span>.weather</span></div>
    <div class="header-right">
      <!-- Theme Toggle -->
      <div class="theme-toggle" role="group" aria-label="Theme">
        <button class="theme-btn" onclick="setTheme('light')" title="Light mode">&#9728; Light</button>
        <button class="theme-btn active" onclick="setTheme('dark')" title="Dark mode">&#9790; Dark</button>
        <button class="theme-btn" onclick="setTheme('oled')" title="OLED black">&#11044; OLED</button>
      </div>
      <!-- Search -->
      <div class="search-bar">
        <input type="text" id="cityInput" placeholder="Search city..." aria-label="City name" />
        <button onclick="searchCity()" aria-label="Search">&#8594;</button>
        <button class="locate-btn" onclick="getLocation()" title="Use my location" aria-label="Use my location">&#8982;</button>
      </div>
    </div>
  </header>

  <!-- STATUS -->
  <div class="status-msg visible" id="statusMsg">
    <span id="statusText">Enter a city name above, or tap the locate button to get started.</span>
  </div>

  <!-- APP -->
  <div id="app">

    <!-- Hero -->
    <div class="hero">
      <div class="card">
        <div class="location-name" id="locName">â€”</div>
        <div class="location-time" id="locTime">â€”</div>
        <div class="temp-row">
          <div class="temp-big" id="tempBig">â€”</div>
          <div class="weather-icon" id="wIcon">ğŸŒ¤</div>
        </div>
        <div class="weather-desc" id="wDesc">â€”</div>
        <div class="meta-grid">
          <div class="meta-item"><div class="meta-label">Feels Like</div><div class="meta-value" id="feelsLike">â€”</div></div>
          <div class="meta-item"><div class="meta-label">Humidity</div><div class="meta-value" id="humidity">â€”</div></div>
          <div class="meta-item"><div class="meta-label">Wind Speed</div><div class="meta-value" id="wind">â€”</div></div>
          <div class="meta-item"><div class="meta-label">UV Index</div><div class="meta-value" id="uv">â€”</div></div>
        </div>
      </div>
      <div class="card">
        <div class="aqi-title">Air Quality Index</div>
        <div class="aqi-header">
          <div>
            <div class="aqi-value" id="aqiVal">â€”</div>
            <div class="aqi-label" id="aqiLabel">â€”</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:0.75rem;font-weight:700;color:var(--text3)">US AQI</div>
            <div style="font-size:0.8rem;font-weight:500;color:var(--text2);margin-top:0.25rem;max-width:135px;line-height:1.5" id="aqiHealthMsg">â€”</div>
          </div>
        </div>
        <div class="aqi-bar-wrap">
          <div class="aqi-bar-track"><div class="aqi-bar-thumb" id="aqiThumb" style="left:0%"></div></div>
          <div class="aqi-bar-labels"><span>Good</span><span>Moderate</span><span>Unhealthy</span><span>Hazardous</span></div>
        </div>
        <div class="poll-grid" id="pollGrid"></div>
      </div>
    </div>

    <!-- Rain Summary -->
    <div class="section-title">&#127783; Rain Summary</div>
    <div class="rain-summary-row" id="rainSummary"></div>

    <!-- Lifestyle -->
    <div class="section-title">&#127775; Lifestyle &amp; Recommendations</div>
    <div class="lifestyle-grid" id="lifestyleGrid"></div>

    <!-- 7-Day -->
    <div class="section-title">&#128197; 7-Day Forecast</div>
    <div class="forecast-row" id="forecastRow"></div>

    <!-- 24h Hourly -->
    <div class="section-title">&#128336; 24-Hour Outlook</div>
    <div class="hourly-scroll" id="hourlyRow"></div>

    <!-- Charts -->
    <div class="section-title">&#128202; Forecast Charts</div>
    <div class="tab-row">
      <button class="tab-btn active" onclick="showChart('rain24')">24h Rain</button>
      <button class="tab-btn" onclick="showChart('aqi24')">24h AQI</button>
      <button class="tab-btn" onclick="showChart('rain7')">7-Day Rain</button>
      <button class="tab-btn" onclick="showChart('aqi7')">7-Day AQI</button>
    </div>
    <div class="chart-card">
      <div class="chart-wrap"><div class="bar-chart" id="chartBars"></div></div>
    </div>

    <!-- Footer -->
    <footer class="foot">
      <div>&copy; <strong>Manik Roy</strong> <span id="footYear"></span> &mdash; All Rights Reserved.</div>
      <div style="margin-top:0.3rem;font-size:0.78rem;">Powered by <a href="https://open-meteo.com" target="_blank" rel="noopener">Open-Meteo</a> &amp; <a href="https://open-meteo.com/en/docs/air-quality-api" target="_blank" rel="noopener">Open-Meteo Air Quality API</a></div>
    </footer>
  </div>
</div>

<script>
/* â”€â”€â”€ Theme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function setTheme(t) {
  document.documentElement.setAttribute('data-theme', t);
  document.querySelectorAll('.theme-btn').forEach((b, i) => {
    b.classList.toggle('active', ['light','dark','oled'][i] === t);
  });
  try { localStorage.setItem('atmos-theme', t); } catch(e) {}
}
// Init theme
(function() {
  let saved = 'dark';
  try { saved = localStorage.getItem('atmos-theme') || 'dark'; } catch(e) {}
  setTheme(saved);
})();

/* â”€â”€â”€ Footer year â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('footYear').textContent = new Date().getFullYear();

/* â”€â”€â”€ WMO & AQI constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const WMO = {
  0:'Clear Sky', 1:'Mainly Clear', 2:'Partly Cloudy', 3:'Overcast',
  45:'Foggy', 48:'Icy Fog', 51:'Light Drizzle', 53:'Drizzle', 55:'Heavy Drizzle',
  61:'Light Rain', 63:'Rain', 65:'Heavy Rain', 71:'Light Snow', 73:'Snow', 75:'Heavy Snow',
  77:'Snow Grains', 80:'Light Showers', 81:'Showers', 82:'Heavy Showers',
  85:'Snow Showers', 86:'Heavy Snow Showers', 95:'Thunderstorm',
  96:'Thunderstorm + Hail', 99:'Thunderstorm + Heavy Hail'
};
const WMO_ICON = {
  0:'â˜€ï¸', 1:'ğŸŒ¤', 2:'â›…', 3:'â˜ï¸', 45:'ğŸŒ«', 48:'ğŸŒ«',
  51:'ğŸŒ¦', 53:'ğŸŒ¦', 55:'ğŸŒ§', 61:'ğŸŒ§', 63:'ğŸŒ§', 65:'ğŸŒ§',
  71:'ğŸŒ¨', 73:'â„ï¸', 75:'â„ï¸', 77:'â„ï¸', 80:'ğŸŒ¦', 81:'ğŸŒ§', 82:'â›ˆ',
  85:'ğŸŒ¨', 86:'â„ï¸', 95:'â›ˆ', 96:'â›ˆ', 99:'â›ˆ'
};
const AQI_INFO = [
  { max:50,  label:'Good',               color:'#22c55e', health:'Air quality is satisfactory.' },
  { max:100, label:'Moderate',           color:'#eab308', health:'Acceptable; some pollutants may concern sensitive groups.' },
  { max:150, label:'Unhealthy for Some', color:'#f97316', health:'Sensitive groups should limit outdoor activity.' },
  { max:200, label:'Unhealthy',          color:'#ef4444', health:'Everyone may begin experiencing health effects.' },
  { max:300, label:'Very Unhealthy',     color:'#a855f7', health:'Health alert: serious effects for everyone.' },
  { max:500, label:'Hazardous',          color:'#9f1239', health:'Emergency conditions. Entire population at risk.' },
];
function getAQIInfo(v) { return AQI_INFO.find(a => v <= a.max) || AQI_INFO[AQI_INFO.length-1]; }
function aqiFromPM25(pm25) {
  const bp = [[0,12,0,50],[12.1,35.4,51,100],[35.5,55.4,101,150],[55.5,150.4,151,200],[150.5,250.4,201,300],[250.5,350.4,301,400],[350.5,500.4,401,500]];
  for (const [lo,hi,ilo,ihi] of bp) if (pm25 >= lo && pm25 <= hi) return Math.round(((ihi-ilo)/(hi-lo))*(pm25-lo)+ilo);
  return 500;
}

/* â”€â”€â”€ Demo Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function demoTimes(n) { return Array.from({length:n},(_,i)=>{ const d=new Date(); d.setMinutes(0,0,0); d.setHours(d.getHours()+i); return d.toISOString().slice(0,16); }); }
function demoDates(n) { return Array.from({length:n},(_,i)=>{ const d=new Date(); d.setDate(d.getDate()+i); return d.toISOString().slice(0,10); }); }
const DEMO = {
  w: {
    current: { temperature_2m:30, apparent_temperature:34, relative_humidity_2m:76, wind_speed_10m:14, weathercode:2, uv_index:7.2 },
    hourly: {
      time: demoTimes(48),
      temperature_2m: [30,29,28,27,26,25,25,26,28,30,32,33,34,34,33,32,31,30,29,28,28,27,26,25,24,24,23,24,26,28,31,33,35,34,33,31,30,29,28,27,27,26,25,24,23,23,24,25],
      weathercode:    [2,2,1,1,0,0,0,1,2,2,3,3,2,2,2,1,1,2,80,80,1,0,0,0,0,0,1,1,2,2,3,80,80,2,2,2,1,1,2,2,1,0,0,0,0,0,0,1],
      precipitation:  [0,0,0,0,0,0,0,0,0,0,0.1,0.4,1.2,0.9,0.3,0,0,0,2.1,3.4,0.5,0,0,0,0,0,0,0,0.1,0.3,1.0,2.8,4.1,0.8,0.2,0,0,0,0,0,0,0,0,0,0,0,0,0],
      precipitation_probability: [10,5,5,0,0,0,0,5,10,15,25,35,45,40,30,15,10,15,60,75,35,5,0,0,0,0,5,10,20,35,55,75,80,45,25,10,10,5,5,10,5,0,0,0,0,0,0,5]
    },
    daily: {
      time: demoDates(7),
      weathercode: [2,80,61,63,2,1,0],
      temperature_2m_max: [34,31,28,27,30,32,35],
      temperature_2m_min: [25,23,22,21,22,23,25],
      precipitation_sum: [1.2,12.4,24.8,18.2,2.1,0,0],
      precipitation_probability_max: [30,70,90,85,35,10,5]
    }
  },
  aq: {
    current: { pm2_5:52.3, pm10:78.1, nitrogen_dioxide:34.4, ozone:58.2, sulphur_dioxide:9.1, carbon_monoxide:620 },
    hourly: {
      time: demoTimes(48),
      pm2_5: [52,54,56,59,62,64,61,57,53,48,44,40,38,36,38,40,44,48,52,56,54,50,46,43,40,38,36,35,38,43,50,58,65,61,55,50,47,44,42,39,37,35,33,32,31,30,31,33]
    }
  }
};

/* â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _chartData = {};
let _currentChartKey = 'rain24';

/* â”€â”€â”€ Demo Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showDemoBanner() {
  if (document.getElementById('demoBanner')) return;
  const b = document.createElement('div');
  b.id = 'demoBanner';
  b.className = 'demo-banner';
  b.innerHTML = '&#9889; Live API unavailable in this preview &mdash; showing demo data. Download and open locally for real-time weather.';
  document.getElementById('app').insertAdjacentElement('afterbegin', b);
}

/* â”€â”€â”€ Fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function fetchWeather(lat, lon, cityLabel) {
  setStatus('<span class="loader"></span> Fetching weather data...');
  try {
    const timeout = new Promise((_,rej) => setTimeout(() => rej(new Error('timeout')), 8000));
    const [wRes, aqRes] = await Promise.race([
      Promise.all([
        fetch('https://api.open-meteo.com/v1/forecast?latitude='+lat+'&longitude='+lon
          +'&current=temperature_2m,apparent_temperature,relative_humidity_2m,wind_speed_10m,weathercode,uv_index'
          +'&hourly=temperature_2m,weathercode,precipitation,precipitation_probability'
          +'&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max'
          +'&timezone=auto&forecast_days=7&wind_speed_unit=kmh'),
        fetch('https://air-quality-api.open-meteo.com/v1/air-quality?latitude='+lat+'&longitude='+lon
          +'&current=pm2_5,pm10,carbon_monoxide,nitrogen_dioxide,ozone,sulphur_dioxide'
          +'&hourly=pm2_5&timezone=auto')
      ]),
      timeout
    ]);
    const [wData, aqData] = await Promise.all([wRes.json(), aqRes.json()]);
    if (wData.error) throw new Error(wData.reason || 'API error');
    renderApp(wData, aqData, cityLabel);
    hideStatus();
  } catch(e) {
    console.warn('API unreachable, using demo data:', e.message);
    renderApp(DEMO.w, DEMO.aq, cityLabel);
    hideStatus();
    showDemoBanner();
  }
}

/* â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderApp(w, aq, label) {
  const c=w.current, d=w.daily, h=w.hourly;
  const DAYS = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

  // Location & time
  document.getElementById('locName').textContent = label;
  document.getElementById('locTime').textContent = new Date().toLocaleString('en-US',{weekday:'long',month:'long',day:'numeric',hour:'numeric',minute:'2-digit',hour12:true});

  // Current weather
  const temp = Math.round(c.temperature_2m);
  const feelsLike = Math.round(c.apparent_temperature);
  const humidity = c.relative_humidity_2m;
  const wind = Math.round(c.wind_speed_10m);
  const uv = c.uv_index ?? 0;

  document.getElementById('tempBig').textContent = temp + 'Â°C';
  document.getElementById('wIcon').textContent = WMO_ICON[c.weathercode] || 'ğŸŒ¤';
  document.getElementById('wDesc').textContent = WMO[c.weathercode] || 'â€”';
  document.getElementById('feelsLike').textContent = feelsLike + 'Â°C';
  document.getElementById('humidity').textContent = humidity + '%';
  document.getElementById('wind').textContent = wind + ' km/h';
  document.getElementById('uv').textContent = uv.toFixed(1);

  // AQI
  const pm25 = aq.current?.pm2_5 ?? 0;
  const aqi = aqiFromPM25(pm25);
  const info = getAQIInfo(aqi);
  document.getElementById('aqiVal').textContent = aqi;
  document.getElementById('aqiVal').style.color = info.color;
  const lbl = document.getElementById('aqiLabel');
  lbl.textContent = info.label;
  lbl.style.background = info.color + '22';
  lbl.style.color = info.color;
  document.getElementById('aqiHealthMsg').textContent = info.health;
  setTimeout(() => { document.getElementById('aqiThumb').style.left = Math.min((aqi/500)*100, 97)+'%'; }, 120);

  // Pollutants
  const polls = [
    { name:'PM2.5', val:aq.current?.pm2_5, unit:'Î¼g/mÂ³', max:150 },
    { name:'PM10',  val:aq.current?.pm10,  unit:'Î¼g/mÂ³', max:300 },
    { name:'NOâ‚‚',   val:aq.current?.nitrogen_dioxide, unit:'Î¼g/mÂ³', max:200 },
    { name:'Oâ‚ƒ',    val:aq.current?.ozone, unit:'Î¼g/mÂ³', max:240 },
    { name:'SOâ‚‚',   val:aq.current?.sulphur_dioxide, unit:'Î¼g/mÂ³', max:500 },
    { name:'CO',    val:aq.current?.carbon_monoxide ? aq.current.carbon_monoxide/1000 : null, unit:'mg/mÂ³', max:30 },
  ];
  document.getElementById('pollGrid').innerHTML = polls.map(p => {
    const v = p.val != null ? p.val.toFixed(1) : 'â€”';
    const pct = p.val != null ? Math.min((p.val/p.max)*100, 100) : 0;
    return `<div class="poll-item">
      <div class="poll-name">${p.name}</div>
      <div class="poll-val">${v} <span style="font-size:0.65rem;color:var(--text3);font-weight:500">${p.unit}</span></div>
      <div class="poll-bar-mini"><div class="poll-bar-fill" style="width:${pct}%"></div></div>
    </div>`;
  }).join('');

  // Hourly start index
  const now = new Date();
  let startIdx = h.time.findIndex(t => new Date(t) >= now);
  if (startIdx < 0) startIdx = 0;
  const h24 = h.time.slice(startIdx, startIdx+24);

  // Rain Summary
  const precArr = h.precipitation || [];
  const precProbArr = h.precipitation_probability || [];
  const rain24 = precArr.slice(startIdx, startIdx+24).reduce((a,b)=>a+(b||0), 0);
  const rainToday = d.precipitation_sum ? (d.precipitation_sum[0]||0) : rain24;
  const weekTotal = d.precipitation_sum ? d.precipitation_sum.reduce((a,b)=>a+(b||0), 0) : 0;
  const maxRain = d.precipitation_sum ? Math.max(...d.precipitation_sum) : 0;
  const rainChance24 = Math.max(...precProbArr.slice(startIdx, startIdx+24), 0);

  document.getElementById('rainSummary').innerHTML = `
    <div class="rain-stat"><div class="rs-label">Rain in 24h</div><div class="rs-val">${rain24.toFixed(1)}<span class="rs-unit"> mm</span></div></div>
    <div class="rain-stat"><div class="rs-label">Today Total</div><div class="rs-val">${rainToday.toFixed(1)}<span class="rs-unit"> mm</span></div></div>
    <div class="rain-stat"><div class="rs-label">Week Total</div><div class="rs-val">${weekTotal.toFixed(1)}<span class="rs-unit"> mm</span></div></div>
    <div class="rain-stat"><div class="rs-label">Heaviest Day</div><div class="rs-val">${maxRain.toFixed(1)}<span class="rs-unit"> mm</span></div></div>
    <div class="rain-stat"><div class="rs-label">Rain Chance</div><div class="rs-val">${rainChance24}<span class="rs-unit"> %</span></div></div>
  `;

  // Lifestyle
  document.getElementById('lifestyleGrid').innerHTML = getLifestyle(temp, feelsLike, humidity, wind, uv, aqi, rainChance24, rain24).map(l =>
    `<div class="lifestyle-card">
      <div class="lf-icon">${l.icon}</div>
      <div class="lf-label">${l.label}</div>
      <div class="lf-value">${l.value}</div>
      <div class="lf-sub">${l.sub}</div>
    </div>`
  ).join('');

  // 7-Day forecast
  const aqiEst = estimate7DayAQI(aqi);
  document.getElementById('forecastRow').innerHTML = d.time.map((dt,i) => {
    const date = new Date(dt+'T00:00:00');
    const dayName = i===0 ? 'Today' : DAYS[date.getDay()];
    const icon = WMO_ICON[d.weathercode[i]] || 'ğŸŒ¤';
    const rain = d.precipitation_sum ? (d.precipitation_sum[i]||0).toFixed(1) : 'â€”';
    const dayAQI = aqiEst[i];
    const dayAQIInfo = getAQIInfo(dayAQI);
    return `<div class="forecast-day ${i===0?'today':''}">
      <div class="fc-day">${dayName}</div>
      <div class="fc-icon">${icon}</div>
      <div class="fc-hi">${Math.round(d.temperature_2m_max[i])}Â°</div>
      <div class="fc-lo">${Math.round(d.temperature_2m_min[i])}Â°</div>
      <div class="fc-rain">ğŸ’§${rain}mm</div>
      <div class="fc-aqi-dot" style="background:${dayAQIInfo.color}" title="AQI ~${dayAQI}: ${dayAQIInfo.label}"></div>
    </div>`;
  }).join('');

  // 24h hourly row
  const hrPM25arr = aq.hourly?.pm2_5 || [];
  document.getElementById('hourlyRow').innerHTML = h24.map((_,i) => {
    const idx = startIdx+i;
    const hr = new Date(h.time[idx]);
    const timeStr = i===0 ? 'Now' : hr.toLocaleTimeString('en-US',{hour:'numeric',hour12:true});
    const icon = WMO_ICON[h.weathercode[idx]] || 'ğŸŒ¤';
    const hrTemp = Math.round(h.temperature_2m[idx]);
    const prec = precArr[idx]||0;
    const prob = precProbArr[idx]||0;
    const hrPM = hrPM25arr[idx] ?? pm25;
    const hrAQI = aqiFromPM25(hrPM);
    const hrAQIInfo = getAQIInfo(hrAQI);
    const rainTxt = prec > 0.05 ? prec.toFixed(1)+'mm' : (prob > 15 ? prob+'%' : 'â€”');
    return `<div class="hourly-item">
      <div class="hr-time">${timeStr}</div>
      <div class="hr-icon">${icon}</div>
      <div class="hr-temp">${hrTemp}Â°</div>
      <div class="hr-rain">${rainTxt}</div>
      <div class="hr-aqi" style="color:${hrAQIInfo.color}">${hrAQI}</div>
    </div>`;
  }).join('');

  // Chart data
  const h24Labels = h24.map((_,i) => {
    const hr = new Date(h.time[startIdx+i]);
    return i===0 ? 'Now' : hr.toLocaleTimeString('en-US',{hour:'numeric',hour12:true});
  });
  _chartData = {
    rain24: { labels:h24Labels, values:h24.map((_,i)=>precArr[startIdx+i]||0), color:'#38bdf8', unit:'mm' },
    aqi24:  { labels:h24Labels, values:h24.map((_,i)=>aqiFromPM25(hrPM25arr[startIdx+i]??pm25)), colorFn:v=>getAQIInfo(v).color, unit:'AQI' },
    rain7:  { labels:d.time.map((dt,i)=>{const date=new Date(dt+'T00:00:00');return i===0?'Today':DAYS[date.getDay()];}), values:d.precipitation_sum?d.precipitation_sum.map(v=>v||0):Array(7).fill(0), color:'#38bdf8', unit:'mm' },
    aqi7:   { labels:d.time.map((dt,i)=>{const date=new Date(dt+'T00:00:00');return i===0?'Today':DAYS[date.getDay()];}), values:aqiEst, colorFn:v=>getAQIInfo(v).color, unit:'AQI' }
  };
  showChart(_currentChartKey);
  document.getElementById('app').classList.add('visible');
}

/* â”€â”€â”€ Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showChart(key) {
  _currentChartKey = key;
  document.querySelectorAll('.tab-btn').forEach((b,i) => {
    b.classList.toggle('active', ['rain24','aqi24','rain7','aqi7'][i] === key);
  });
  const data = _chartData[key]; if (!data) return;
  const vals = data.values;
  const maxVal = Math.max(...vals, 0.1);
  document.getElementById('chartBars').innerHTML = vals.map((v,i) => {
    const hPct = Math.max((v/maxVal)*100, 2);
    const color = data.colorFn ? data.colorFn(v) : data.color;
    const disp = data.unit==='AQI' ? Math.round(v) : v.toFixed(1);
    return `<div class="bar-col">
      <div class="bar-val" style="color:${color}">${disp}</div>
      <div class="bar-fill" style="height:${hPct}%;background:${color};opacity:0.82"></div>
      <div class="bar-label">${data.labels[i]}</div>
    </div>`;
  }).join('');
}

/* â”€â”€â”€ Lifestyle Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getLifestyle(temp, feelsLike, humidity, wind, uv, aqi, rainChance, rain24) {
  const items = [];
  // AC / Fan
  if (feelsLike>=35||(feelsLike>=30&&humidity>75))  items.push({icon:'â„ï¸', label:'AC', value:'Strongly Recommended', sub:'Heat index critical â€” set AC to 24Â°C'});
  else if (feelsLike>=28&&humidity>65)              items.push({icon:'â„ï¸', label:'AC', value:'Recommended', sub:'Feels '+feelsLike+'Â°C â€” set AC to 25â€“26Â°C'});
  else if (feelsLike>=25)                           items.push({icon:'ğŸŒ€', label:'Fan', value:'Sufficient', sub:'Feels '+feelsLike+'Â°C â€” fan provides comfort'});
  else                                              items.push({icon:'ğŸŒ¿', label:'Ventilation', value:'No Cooling Needed', sub:'Feels '+feelsLike+'Â°C â€” naturally comfortable'});
  // Umbrella
  if (rain24>10||rainChance>70)     items.push({icon:'â˜‚ï¸', label:'Umbrella', value:'Essential', sub:rainChance+'% rain, '+rain24.toFixed(1)+'mm expected'});
  else if (rain24>2||rainChance>40) items.push({icon:'ğŸŒ‚', label:'Umbrella', value:'Advisable', sub:rainChance+'% chance â€” carry one just in case'});
  else                              items.push({icon:'ğŸŒ', label:'Umbrella', value:'Not Needed', sub:'Only '+rainChance+'% rain chance today'});
  // Outdoors
  if (aqi>200)         items.push({icon:'ğŸ ', label:'Outdoors', value:'Stay Indoors', sub:'Hazardous air â€” avoid going outside'});
  else if (aqi>100)    items.push({icon:'ğŸ˜·', label:'Outdoors', value:'Limit Time', sub:'Wear a mask if going outside'});
  else if (rainChance>75) items.push({icon:'ğŸ ', label:'Outdoors', value:'Heavy Rain Likely', sub:'Plan indoor activities instead'});
  else                 items.push({icon:'ğŸƒ', label:'Outdoors', value:'Good to Go', sub:'Conditions are suitable for outdoor activity'});
  // UV
  if (uv>=8)      items.push({icon:'ğŸ•¶ï¸', label:'Sun Protection', value:'Very High UV '+uv.toFixed(0), sub:'SPF 50+, hat & shade essential 10amâ€“4pm'});
  else if (uv>=5) items.push({icon:'ğŸ§´', label:'Sun Protection', value:'High UV '+uv.toFixed(0), sub:'Apply SPF 30+ â€” reapply every 2 hours'});
  else if (uv>=3) items.push({icon:'ğŸ˜', label:'Sun Protection', value:'Moderate UV '+uv.toFixed(0), sub:'Sunscreen recommended if outside for long'});
  else            items.push({icon:'ğŸŒ¤', label:'Sun Protection', value:'Low UV '+uv.toFixed(0), sub:'Minimal protection needed today'});
  // Mask
  if (aqi>200)      items.push({icon:'ğŸ˜·', label:'Face Mask', value:'N95 Required', sub:'Very hazardous air â€” N95/KN95 is essential'});
  else if (aqi>100) items.push({icon:'ğŸ˜·', label:'Face Mask', value:'Recommended', sub:'Consider a mask for outdoor exposure'});
  else              items.push({icon:'âœ…', label:'Face Mask', value:'Optional', sub:'AQI '+aqi+' â€” air quality is acceptable'});
  // Hydration
  if (feelsLike>=36)      items.push({icon:'ğŸ’§', label:'Hydration', value:'Drink Frequently', sub:'Heat stress risk â€” 3.5+ litres today'});
  else if (feelsLike>=29) items.push({icon:'ğŸ’§', label:'Hydration', value:'Stay Hydrated', sub:'Drink 2.5â€“3 litres throughout the day'});
  else                    items.push({icon:'ğŸ¥¤', label:'Hydration', value:'Normal Intake', sub:'Regular 1.5â€“2 litres is sufficient'});
  return items;
}

/* â”€â”€â”€ 7-Day AQI estimate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function estimate7DayAQI(aqi) {
  return [1,1.06,0.97,1.12,0.91,0.86,0.94].map(f => Math.min(500, Math.max(1, Math.round(aqi*f))));
}

/* â”€â”€â”€ Status helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function setStatus(html) {
  document.getElementById('statusMsg').classList.add('visible');
  document.getElementById('statusText').innerHTML = html;
  document.getElementById('app').classList.remove('visible');
}
function hideStatus() {
  document.getElementById('statusMsg').classList.remove('visible');
  document.getElementById('app').classList.add('visible');
}

/* â”€â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function searchCity() {
  const city = document.getElementById('cityInput').value.trim();
  if (!city) return;
  setStatus('<span class="loader"></span> Searching for "'+city+'"...');
  try {
    const res = await fetch('https://geocoding-api.open-meteo.com/v1/search?name='+encodeURIComponent(city)+'&count=1');
    const data = await res.json();
    if (!data.results?.length) { setStatus('<span class="error">City not found. Please try another name.</span>'); return; }
    const r = data.results[0];
    fetchWeather(r.latitude, r.longitude, r.name+(r.admin1?', '+r.admin1:'')+', '+r.country);
  } catch(e) { setStatus('<span class="error">Search failed. Please check your connection.</span>'); }
}

/* â”€â”€â”€ Geolocation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getLocation() {
  if (!navigator.geolocation) { setStatus('<span class="error">Geolocation is not supported by your browser.</span>'); return; }
  setStatus('<span class="loader"></span> Getting your current location...');
  navigator.geolocation.getCurrentPosition(async pos => {
    const { latitude:lat, longitude:lon } = pos.coords;
    try {
      const res = await fetch('https://nominatim.openstreetmap.org/reverse?lat='+lat+'&lon='+lon+'&format=json');
      const data = await res.json();
      const city = data.address?.city || data.address?.town || data.address?.village || lat.toFixed(2)+', '+lon.toFixed(2);
      fetchWeather(lat, lon, city+', '+(data.address?.country||''));
    } catch { fetchWeather(lat, lon, lat.toFixed(2)+'Â°N, '+lon.toFixed(2)+'Â°E'); }
  }, () => setStatus('<span class="error">Location access was denied. Please search manually.</span>'));
}

/* â”€â”€â”€ Enter key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('cityInput').addEventListener('keydown', e => { if (e.key==='Enter') searchCity(); });

/* â”€â”€â”€ Auto-load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
fetchWeather(22.5726, 88.3639, 'Kolkata, West Bengal, India');
</script>
</body>
</html>