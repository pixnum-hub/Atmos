<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Atmos">
<meta name="application-name" content="Atmos">
<meta name="theme-color" id="themeColorMeta" content="#0a0f1e">
<meta name="description" content="Atmos â€” Real-time weather forecast with AQI, rain, and lifestyle recommendations.">
<meta name="keywords" content="weather, AQI, air quality, forecast, rain, UV index">
<meta name="author" content="Manik Roy">
<meta name="robots" content="index,follow">
<!-- Open Graph -->
<meta property="og:title" content="Atmos â€” Weather &amp; Air Quality">
<meta property="og:description" content="Real-time weather forecast with AQI, rain, and lifestyle recommendations.">
<meta property="og:type" content="website">
<!-- PWA manifest injected by JS below -->
<link rel="manifest" id="pwaManifest">
<!-- Apple touch icons (generated by JS) -->
<link rel="apple-touch-icon" id="appleTouchIcon">
<link rel="icon" type="image/png" id="faviconLink">
<title>Atmos â€” Weather &amp; Air Quality</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Nunito:wght@600;700;800;900&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --accent:       #38bdf8;
  --accent2:      #818cf8;
  --rain:         #38bdf8;
  --r-card:       16px;
  --r-sm:         10px;
  --r-pill:       100px;
  --font-body:    'Inter', system-ui, -apple-system, sans-serif;
  --font-display: 'Nunito', system-ui, -apple-system, sans-serif;
  --ease:         0.22s ease;
  /* safe area insets for notched phones */
  --safe-top:    env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left:   env(safe-area-inset-left, 0px);
  --safe-right:  env(safe-area-inset-right, 0px);
}

/* DARK */
[data-theme="dark"] {
  --bg:     #0a0f1e;
  --bg2:    #0d1830;
  --card:   rgba(255,255,255,0.048);
  --border: rgba(255,255,255,0.09);
  --text:   #e8edf5;
  --text2:  #94a3b8;
  --text3:  #64748b;
  --shadow: 0 2px 16px rgba(0,0,0,0.45);
  --glow:   rgba(56,189,248,0.07);
  --glow2:  rgba(129,140,248,0.06);
  --nav-bg: rgba(10,15,30,0.92);
}
/* LIGHT */
[data-theme="light"] {
  --bg:     #f0f4fb;
  --bg2:    #e2e9f5;
  --card:   rgba(255,255,255,0.88);
  --border: rgba(0,0,0,0.08);
  --text:   #0f172a;
  --text2:  #475569;
  --text3:  #94a3b8;
  --shadow: 0 2px 16px rgba(0,0,0,0.09);
  --glow:   rgba(56,189,248,0.10);
  --glow2:  rgba(129,140,248,0.07);
  --nav-bg: rgba(240,244,251,0.95);
  --accent:  #0284c7;
  --accent2: #6366f1;
  --rain:    #0284c7;
}
/* OLED */
[data-theme="oled"] {
  --bg:     #000000;
  --bg2:    #080808;
  --card:   rgba(255,255,255,0.032);
  --border: rgba(255,255,255,0.07);
  --text:   #f1f5f9;
  --text2:  #94a3b8;
  --text3:  #475569;
  --shadow: 0 2px 20px rgba(0,0,0,0.85);
  --glow:   rgba(56,189,248,0.05);
  --glow2:  rgba(129,140,248,0.04);
  --nav-bg: rgba(0,0,0,0.96);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

html {
  font-size: 16px;
  height: 100%;
  /* hard-clamp: nothing can cause horizontal scroll */
  overflow-x: hidden;
  -webkit-text-size-adjust: 100%;
}
@media(min-width:768px){ html { font-size:17px; } }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow-x: clip; /* stronger than hidden - works with sticky/fixed children */
  /* leave room for fixed bottom nav */
  padding-bottom: calc(68px + var(--safe-bottom));
  transition: background var(--ease), color var(--ease);
  -webkit-font-smoothing: antialiased;
}

body::before {
  content:'';
  position:fixed; inset:0; z-index:0; pointer-events:none;
  background:
    radial-gradient(ellipse 80% 50% at 20% 10%, var(--glow) 0%, transparent 60%),
    radial-gradient(ellipse 60% 40% at 80% 80%, var(--glow2) 0%, transparent 60%);
  transition: background var(--ease);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT WRAPPER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page {
  width: 100%;
  max-width: 680px;
  margin: 0 auto;
  padding: 0 1rem;
  position: relative; z-index:1;
  overflow-x: hidden;
  /* account for left+right padding in width calculation */
  box-sizing: border-box;
}
@media(min-width:1024px){ .page { max-width: 1080px; } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOP HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: calc(1rem + var(--safe-top)) 0 0.75rem;
  gap: 0.5rem;
  position: sticky; top: 0; z-index: 100;
  background: var(--bg);
  transition: background var(--ease);
  /* never wider than viewport */
  width: 100%;
  min-width: 0;
}
@media(min-width:768px){
  .topbar { padding-top: calc(1.25rem + var(--safe-top)); }
}

.logo {
  font-family: var(--font-display);
  font-size: clamp(1.25rem, 5vw, 1.9rem);
  font-weight: 900;
  letter-spacing: -0.03em;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
  /* allow shrinking on very small screens */
  flex-shrink: 1;
  min-width: 0;
  white-space: nowrap;
}
.logo span { font-weight:600; opacity:0.5; }

/* Theme toggle â€” compact icon-only on mobile */
.theme-toggle {
  display: flex;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r-pill);
  padding: 3px; gap: 2px;
  flex-shrink: 0;
  /* never overflow its own box */
  overflow: hidden;
}
.theme-btn {
  background: none; border: none;
  color: var(--text3);
  padding: 0.35rem 0.55rem;
  border-radius: var(--r-pill);
  cursor: pointer;
  font-size: 0.88rem;
  font-family: var(--font-body);
  font-weight: 600;
  transition: all 0.2s;
  display: flex; align-items: center;
  min-width: 34px; min-height: 34px; justify-content: center;
}
.theme-btn .btn-label { display:none; }
@media(min-width:600px){
  .theme-btn { padding: 0.38rem 0.9rem; gap: 0.3rem; }
  .theme-btn .btn-label { display:inline; font-size:0.78rem; }
}
.theme-btn.active {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff;
  box-shadow: 0 2px 8px rgba(56,189,248,0.3);
}
.theme-btn:not(.active):hover { color: var(--text); background: rgba(255,255,255,0.08); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH BAR â€” full-width on mobile
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.search-wrap {
  padding: 0 0 1rem;
  overflow: hidden;
}
.search-bar {
  display: flex; gap: 0.5rem;
  width: 100%; max-width: 100%;
  overflow: hidden;
}
.search-bar input {
  flex: 1 1 0; min-width: 0;
  background: var(--card);
  border: 2px solid var(--border);
  color: var(--text);
  padding: 0.78rem 0.85rem;
  border-radius: var(--r-sm);
  font-family: var(--font-body);
  font-weight: 500; outline: none;
  transition: border-color 0.2s, background 0.2s;
  font-size: max(1rem, 16px);
}
.search-bar input:focus { border-color: var(--accent); }
.search-bar input::placeholder { color: var(--text3); }

.btn-icon {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border: none; color: #fff; padding: 0;
  border-radius: var(--r-sm); cursor: pointer;
  font-size: 1.1rem; font-weight: 700;
  transition: opacity 0.2s, transform 0.15s;
  flex: 0 0 46px; width: 46px; height: 46px;
  display: flex; align-items: center; justify-content: center;
  -webkit-touch-callout: none;
}
.btn-icon:active { transform: scale(0.94); opacity: 0.9; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAV (mobile-primary navigation)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  z-index: 200;
  background: var(--nav-bg);
  border-top: 1px solid var(--border);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  display: flex;
  padding-bottom: var(--safe-bottom);
  padding-left: var(--safe-left);
  padding-right: var(--safe-right);
  transition: background var(--ease);
  /* stays within viewport width */
  width: 100%;
  box-sizing: border-box;
}
.nav-btn {
  flex: 1;
  background: none; border: none;
  color: var(--text3);
  padding: 0.6rem 0.25rem 0.5rem;
  cursor: pointer;
  display: flex; flex-direction: column; align-items: center; gap: 0.2rem;
  font-family: var(--font-body);
  transition: color 0.2s;
  min-height: 56px;
  -webkit-touch-callout: none;
}
.nav-btn .nav-icon { font-size: 1.35rem; line-height: 1; }
.nav-btn .nav-label { font-size: 0.6rem; font-weight: 700; letter-spacing: 0.04em; text-transform: uppercase; }
.nav-btn.active { color: var(--accent); }
.nav-btn:active { opacity: 0.7; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATUS / LOADING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.status-msg {
  text-align: center; color: var(--text2);
  font-size: 1rem; font-weight: 500;
  padding: 5rem 1rem; display: none;
  line-height: 1.6;
}
.status-msg.visible { display: block; }
.loader {
  display: inline-block; width: 20px; height: 20px;
  border: 2.5px solid var(--border); border-top-color: var(--accent);
  border-radius: 50%; animation: spin 0.8s linear infinite;
  vertical-align: middle; margin-right: 0.5rem;
}
@keyframes spin { to { transform:rotate(360deg); } }

.error { color: #ef4444; font-weight: 700; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTIONS (tab panels)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section { display: none; animation: fadeUp 0.35s ease; }
.section.active { display: block; }
@keyframes fadeUp { from{opacity:0;transform:translateY(14px);} to{opacity:1;transform:translateY(0);} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r-card);
  padding: 1.25rem;
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  position: relative; overflow: hidden;
  box-shadow: var(--shadow);
  transition: background var(--ease), border-color var(--ease);
  /* prevent card from stretching its grid/flex container */
  min-width: 0;
  width: 100%;
  box-sizing: border-box;
}
@media(min-width:600px){ .card { padding: 1.6rem; } }
.card::before {
  content:''; position:absolute; top:0; left:0; right:0; height:1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
}
[data-theme="light"] .card::before { background: linear-gradient(90deg,transparent,rgba(255,255,255,0.9),transparent); }

/* section heading */
.sec-title {
  font-family: var(--font-display);
  font-size: 0.72rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.15em;
  color: var(--text2);
  margin: 1.4rem 0 0.75rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO â€” WEATHER & AQI
   Mobile: stacked full-width; Tablet+: 2-col grid
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
  width: 100%;
  min-width: 0;
}
@media(min-width:640px){
  .hero-grid { grid-template-columns: 1fr 1fr; }
}

/* weather card inner */
.location-name {
  font-family: var(--font-display);
  font-size: clamp(1.2rem, 4.5vw, 1.5rem);
  font-weight: 800; color: var(--text);
  margin-bottom: 0.15rem;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.location-time {
  font-size: 0.82rem; font-weight: 500; color: var(--text2);
  margin-bottom: 1.1rem;
}
.temp-row { display: flex; align-items: flex-end; gap: 0.5rem; margin-bottom: 0.3rem; }
.temp-big {
  font-family: var(--font-display);
  font-size: clamp(4rem, 14vw, 5.5rem);
  font-weight: 900; line-height: 1; letter-spacing: -0.04em;
  background: linear-gradient(135deg, var(--text), var(--accent));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}
.weather-icon { font-size: clamp(2.4rem, 9vw, 3.2rem); line-height: 1; }
.weather-desc {
  font-size: 0.82rem; font-weight: 700; color: var(--text2);
  text-transform: uppercase; letter-spacing: 0.12em;
  margin-bottom: 1.1rem;
}

/* meta grid (feels like, humidityâ€¦) */
.meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.55rem; }
.meta-item {
  background: rgba(255,255,255,0.04);
  border-radius: var(--r-sm);
  padding: 0.6rem 0.85rem;
  border: 1px solid var(--border);
}
[data-theme="light"] .meta-item { background: rgba(0,0,0,0.04); }
.meta-label { font-size: 0.65rem; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.08em; }
.meta-value { font-size: 1rem; font-weight: 700; margin-top: 0.1rem; color: var(--text); }

/* AQI card */
.aqi-title {
  font-family: var(--font-display);
  font-size: 0.72rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.14em; color: var(--text2);
  margin-bottom: 0.3rem;
}
.aqi-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.9rem; }
.aqi-value {
  font-family: var(--font-display);
  font-size: clamp(3rem, 11vw, 4.5rem);
  font-weight: 900; line-height: 1; letter-spacing: -0.04em;
}
.aqi-label {
  font-size: 0.68rem; font-weight: 800;
  padding: 0.22rem 0.75rem;
  border-radius: var(--r-pill);
  display: inline-block; margin-top: 0.35rem;
  text-transform: uppercase; letter-spacing: 0.07em;
}
.aqi-bar-track {
  height: 9px; border-radius: 5px; position: relative; margin-bottom: 0.35rem;
  background: linear-gradient(90deg,#34d399,#fbbf24,#f97316,#ef4444,#a855f7,#7f1d1d);
}
.aqi-bar-thumb {
  position: absolute; top:50%; transform:translate(-50%,-50%);
  width:15px; height:15px; border-radius:50%;
  background:#fff; box-shadow:0 0 0 3px rgba(255,255,255,0.35);
  transition: left 0.9s cubic-bezier(0.34,1.56,0.64,1);
}
.aqi-bar-labels { display:flex; justify-content:space-between; font-size:0.6rem; font-weight:600; color:var(--text3); }

/* pollutants */
.poll-grid { display:grid; grid-template-columns:1fr 1fr; gap:0.55rem; margin-top:0.85rem; }
.poll-item {
  background: rgba(255,255,255,0.035);
  border-radius: var(--r-sm); padding:0.55rem 0.8rem;
  border: 1px solid var(--border);
}
[data-theme="light"] .poll-item { background: rgba(0,0,0,0.035); }
.poll-name { font-size:0.64rem; font-weight:700; color:var(--text3); text-transform:uppercase; letter-spacing:0.07em; }
.poll-val { font-size:0.92rem; font-weight:700; margin-top:0.1rem; color:var(--text); }
.poll-bar-mini { height:3px; border-radius:2px; margin-top:0.35rem; background:var(--border); position:relative; overflow:hidden; }
.poll-bar-fill { position:absolute; left:0; top:0; bottom:0; border-radius:2px; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width 0.9s ease; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RAIN SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rain-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
}
@media(min-width:480px){ .rain-grid { grid-template-columns: repeat(3, 1fr); } }
@media(min-width:860px){ .rain-grid { grid-template-columns: repeat(5, 1fr); } }

.rain-stat {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r-card);
  padding: 1rem; backdrop-filter: blur(8px);
  box-shadow: var(--shadow);
}
.rs-label { font-size:0.64rem; font-weight:700; color:var(--text3); text-transform:uppercase; letter-spacing:0.08em; margin-bottom:0.3rem; }
.rs-val { font-family:var(--font-display); font-size:1.45rem; font-weight:900; color:var(--rain); }
.rs-unit { font-size:0.7rem; color:var(--text2); font-weight:500; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIFESTYLE GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.lifestyle-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.75rem;
}
@media(min-width:640px){ .lifestyle-grid { grid-template-columns: repeat(3,1fr); } }
@media(min-width:900px){ .lifestyle-grid { grid-template-columns: repeat(3,1fr); } }

.lf-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r-card);
  padding: 1rem 1rem 1.1rem;
  backdrop-filter: blur(8px);
  display: flex; flex-direction: column; gap: 0.3rem;
  box-shadow: var(--shadow);
  transition: transform 0.2s, background var(--ease);
}
.lf-card:active { transform: scale(0.97); }
.lf-icon { font-size: 1.65rem; }
.lf-label { font-size: 0.63rem; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.08em; }
.lf-value { font-family: var(--font-display); font-size: 0.95rem; font-weight: 800; color: var(--text); line-height: 1.25; }
.lf-sub { font-size: 0.75rem; font-weight: 500; color: var(--text2); line-height: 1.4; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   7-DAY FORECAST
   Mobile: horizontal scroll; Tablet+: 7-col grid
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.forecast-scroll {
  display: flex; gap: 0.65rem;
  overflow-x: auto; padding-bottom: 0.5rem;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.forecast-scroll::-webkit-scrollbar { display: none; }
@media(min-width:640px){
  .forecast-scroll {
    display: grid;
    grid-template-columns: repeat(7,1fr);
    overflow-x: visible;
  }
}

.forecast-day {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r-card);
  padding: 0.85rem 0.55rem;
  text-align: center; flex-shrink: 0;
  min-width: 72px;
  backdrop-filter: blur(8px);
  box-shadow: var(--shadow);
  transition: border-color 0.2s, transform 0.2s, background var(--ease);
}
@media(min-width:640px){ .forecast-day { min-width: unset; } }
.forecast-day:active { transform: scale(0.96); }
.forecast-day.today { border-color: rgba(56,189,248,0.4); background: rgba(56,189,248,0.07); }
.fc-day { font-size: 0.65rem; font-weight: 800; color: var(--text2); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.35rem; }
.fc-icon { font-size: 1.55rem; margin-bottom: 0.3rem; }
.fc-hi { font-family: var(--font-display); font-weight: 800; font-size: 0.95rem; color: var(--text); }
.fc-lo { font-size: 0.75rem; font-weight: 600; color: var(--text2); }
.fc-rain { font-size: 0.63rem; font-weight: 700; color: var(--rain); margin-top: 0.28rem; }
.fc-aqi-dot { width: 9px; height: 9px; border-radius: 50%; margin: 0.3rem auto 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   24H HOURLY SCROLL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hourly-scroll {
  display: flex; gap: 0.6rem;
  overflow-x: auto; padding-bottom: 0.5rem;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.hourly-scroll::-webkit-scrollbar { display: none; }

.hourly-item {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r-card);
  padding: 0.7rem 0.85rem;
  text-align: center; flex-shrink: 0;
  min-width: 66px;
  backdrop-filter: blur(8px);
  box-shadow: var(--shadow);
  transition: background var(--ease);
}
.hr-time { font-size: 0.65rem; font-weight: 700; color: var(--text2); margin-bottom: 0.28rem; }
.hr-icon { font-size: 1.25rem; margin-bottom: 0.22rem; }
.hr-temp { font-family: var(--font-display); font-size: 0.9rem; font-weight: 800; color: var(--text); }
.hr-rain { font-size: 0.63rem; font-weight: 600; color: var(--rain); margin-top: 0.18rem; }
.hr-aqi { font-size: 0.63rem; margin-top: 0.15rem; font-weight: 800; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHART TABS + BAR CHART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tab-row {
  display: flex; gap: 0.45rem;
  overflow-x: auto; padding-bottom: 0.3rem;
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
  margin-bottom: 0.85rem;
}
.tab-row::-webkit-scrollbar { display: none; }

.tab-btn {
  background: var(--card);
  border: 1px solid var(--border);
  color: var(--text2);
  padding: 0.45rem 1rem;
  border-radius: var(--r-pill);
  font-family: var(--font-body);
  font-size: 0.8rem; font-weight: 700;
  cursor: pointer; flex-shrink: 0;
  transition: all 0.2s;
  white-space: nowrap;
  min-height: 36px;
}
.tab-btn.active {
  background: rgba(56,189,248,0.14);
  border-color: rgba(56,189,248,0.5);
  color: var(--accent);
}
.tab-btn:active { opacity: 0.75; }

.chart-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r-card);
  padding: 1.1rem 1rem;
  backdrop-filter: blur(8px);
  box-shadow: var(--shadow);
  overflow: hidden;
}
.chart-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
.bar-chart {
  display: flex; align-items: flex-end; gap: 4px;
  height: 140px; min-width: 520px;
}
.bar-col { display:flex; flex-direction:column; align-items:center; flex:1; gap:4px; }
.bar-fill { width:100%; border-radius:4px 4px 0 0; min-height:3px; }
.bar-label { font-size:0.72rem; font-weight:700; color:var(--text2); white-space:nowrap; }
.bar-val { font-size:0.75rem; font-weight:800; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DEMO BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.demo-banner {
  background: rgba(251,191,36,0.10);
  border: 1px solid rgba(251,191,36,0.3);
  border-radius: var(--r-sm);
  padding: 0.65rem 1rem;
  font-size: 0.82rem; font-weight: 600;
  color: #d97706; text-align: center;
  margin-bottom: 1rem; line-height: 1.5;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.foot {
  text-align: center; color: var(--text3);
  font-size: 0.8rem; font-weight: 500;
  margin-top: 2rem; padding: 1.25rem 0 0.5rem;
  border-top: 1px solid var(--border);
  line-height: 1.7;
}
.foot strong { font-family: var(--font-display); font-weight: 800; color: var(--text2); }
.foot a { color: var(--accent); text-decoration: none; font-weight: 600; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESKTOP SIDEBAR LAYOUT (1024px+)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(min-width:1024px){
  body { padding-bottom: 0; }
  .bottom-nav { display: none; }
  .page { max-width: 1080px; padding: 0 2rem; }

  /* Show all sections at once, no tabs */
  .section { display: block !important; animation: none; }

  /* Two-column desktop layout */
  .desktop-cols {
    display: grid;
    grid-template-columns: 380px 1fr;
    gap: 1.5rem;
    align-items: start;
  }
  .desktop-left { position: sticky; top: 80px; }
  .desktop-right {}
}
</style>
</head>
<body>
<div class="page">

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="logo">Atmos<span>.wx</span></div>
    <div class="theme-toggle" role="group" aria-label="Color theme">
      <button class="theme-btn" onclick="setTheme('light')" title="Light mode" aria-label="Light mode">
        &#9728;<span class="btn-label"> Light</span>
      </button>
      <button class="theme-btn active" onclick="setTheme('dark')" title="Dark mode" aria-label="Dark mode">
        &#9790;<span class="btn-label"> Dark</span>
      </button>
      <button class="theme-btn" onclick="setTheme('oled')" title="OLED black" aria-label="OLED black">
        &#11044;<span class="btn-label"> OLED</span>
      </button>
    </div>
  </div>

  <!-- SEARCH -->
  <div class="search-wrap">
    <div class="search-bar">
      <input type="search" id="cityInput" placeholder="Search city or place..." autocomplete="off" autocorrect="off" spellcheck="false" aria-label="City name" inputmode="search" />
      <button class="btn-icon" onclick="searchCity()" aria-label="Search">&#8594;</button>
      <button class="btn-icon" onclick="getLocation()" aria-label="Use my location" title="Use my location">&#8982;</button>
    </div>
  </div>

  <!-- STATUS -->
  <div class="status-msg visible" id="statusMsg">
    <span id="statusText">Tap the locate button or search a city to get started.</span>
  </div>

  <!-- APP CONTENT -->
  <div id="app" style="display:none">

    <!-- DESKTOP: two-column wrapper -->
    <div class="desktop-cols">

      <!-- LEFT COL (desktop) / WEATHER SECTION (mobile) -->
      <div class="desktop-left">
        <!-- WEATHER -->
        <div class="section active" id="sec-weather">
          <div class="hero-grid">
            <!-- Current Conditions -->
            <div class="card" id="weatherCard">
              <div class="location-name" id="locName">â€”</div>
              <div class="location-time" id="locTime">â€”</div>
              <div class="temp-row">
                <div class="temp-big" id="tempBig">â€”</div>
                <div class="weather-icon" id="wIcon">ğŸŒ¤</div>
              </div>
              <div class="weather-desc" id="wDesc">â€”</div>
              <div class="meta-grid">
                <div class="meta-item"><div class="meta-label">Feels Like</div><div class="meta-value" id="feelsLike">â€”</div></div>
                <div class="meta-item"><div class="meta-label">Humidity</div><div class="meta-value" id="humidity">â€”</div></div>
                <div class="meta-item"><div class="meta-label">Wind</div><div class="meta-value" id="wind">â€”</div></div>
                <div class="meta-item"><div class="meta-label">UV Index</div><div class="meta-value" id="uv">â€”</div></div>
              </div>
            </div>
            <!-- AQI -->
            <div class="card">
              <div class="aqi-title">Air Quality Index</div>
              <div class="aqi-header">
                <div>
                  <div class="aqi-value" id="aqiVal">â€”</div>
                  <div class="aqi-label" id="aqiLabel">â€”</div>
                </div>
                <div style="text-align:right">
                  <div style="font-size:0.68rem;font-weight:700;color:var(--text3)">US AQI</div>
                  <div style="font-size:0.75rem;font-weight:500;color:var(--text2);margin-top:0.2rem;max-width:120px;line-height:1.45" id="aqiHealthMsg">â€”</div>
                </div>
              </div>
              <div class="aqi-bar-wrap" style="margin:0.85rem 0">
                <div class="aqi-bar-track"><div class="aqi-bar-thumb" id="aqiThumb" style="left:0%"></div></div>
                <div class="aqi-bar-labels"><span>Good</span><span>Moderate</span><span>Unhealthy</span><span>Hazardous</span></div>
              </div>
              <div class="poll-grid" id="pollGrid"></div>
            </div>
          </div>

          <!-- 24h Hourly (visible in weather tab) -->
          <div class="sec-title">&#128336; 24-Hour Outlook</div>
          <div class="hourly-scroll" id="hourlyRow"></div>

          <!-- Rain Summary (in weather tab on mobile) -->
          <div class="sec-title">&#127783; Rain Summary</div>
          <div class="rain-grid" id="rainSummary"></div>
        </div>
      </div><!-- /desktop-left -->

      <!-- RIGHT COL (desktop) / other sections (mobile) -->
      <div class="desktop-right">

        <!-- FORECAST SECTION -->
        <div class="section" id="sec-forecast">
          <div class="sec-title">&#128197; 7-Day Forecast</div>
          <div class="forecast-scroll" id="forecastRow"></div>

          <div class="sec-title">&#128202; Forecast Charts</div>
          <div class="tab-row">
            <button class="tab-btn active" onclick="showChart('rain24')">24h Rain</button>
            <button class="tab-btn" onclick="showChart('aqi24')">24h AQI</button>
            <button class="tab-btn" onclick="showChart('rain7')">7-Day Rain</button>
            <button class="tab-btn" onclick="showChart('aqi7')">7-Day AQI</button>
          </div>
          <div class="chart-card">
            <div class="chart-scroll"><div class="bar-chart" id="chartBars"></div></div>
          </div>
        </div>

        <!-- LIFESTYLE SECTION -->
        <div class="section" id="sec-life">
          <div class="sec-title">&#127775; Lifestyle &amp; Recommendations</div>
          <div class="lifestyle-grid" id="lifestyleGrid"></div>
        </div>

        <!-- DESKTOP: also show forecast + lifestyle inline -->
        <div class="desktop-extra">
          <!-- populated by JS on desktop -->
        </div>

      </div><!-- /desktop-right -->
    </div><!-- /desktop-cols -->

    <!-- FOOTER -->
    <footer class="foot">
      <div>&copy; <strong>Manik Roy</strong> <span id="footYear"></span> &mdash; All Rights Reserved.</div>

    </footer>
  </div><!-- /#app -->

</div><!-- /.page -->

<!-- BOTTOM NAV (mobile only) -->
<nav class="bottom-nav" aria-label="Main navigation">
  <button class="nav-btn active" onclick="switchTab('weather')" aria-label="Weather" id="nav-weather">
    <span class="nav-icon">ğŸŒ¤</span>
    <span class="nav-label">Weather</span>
  </button>
  <button class="nav-btn" onclick="switchTab('forecast')" aria-label="Forecast" id="nav-forecast">
    <span class="nav-icon">ğŸ“…</span>
    <span class="nav-label">Forecast</span>
  </button>
  <button class="nav-btn" onclick="switchTab('life')" aria-label="Lifestyle" id="nav-life">
    <span class="nav-icon">ğŸŒ¿</span>
    <span class="nav-label">Lifestyle</span>
  </button>
</nav>

<script>
'use strict';

/* â”€â”€â”€ WMO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const WMO = {0:'Clear Sky',1:'Mainly Clear',2:'Partly Cloudy',3:'Overcast',45:'Foggy',48:'Icy Fog',51:'Light Drizzle',53:'Drizzle',55:'Heavy Drizzle',61:'Light Rain',63:'Rain',65:'Heavy Rain',71:'Light Snow',73:'Snow',75:'Heavy Snow',77:'Snow Grains',80:'Light Showers',81:'Showers',82:'Heavy Showers',85:'Snow Showers',86:'Heavy Snow Showers',95:'Thunderstorm',96:'Thunderstorm+Hail',99:'Thunderstorm+Heavy Hail'};
const WMO_ICON = {0:'â˜€ï¸',1:'ğŸŒ¤',2:'â›…',3:'â˜ï¸',45:'ğŸŒ«',48:'ğŸŒ«',51:'ğŸŒ¦',53:'ğŸŒ¦',55:'ğŸŒ§',61:'ğŸŒ§',63:'ğŸŒ§',65:'ğŸŒ§',71:'ğŸŒ¨',73:'â„ï¸',75:'â„ï¸',77:'â„ï¸',80:'ğŸŒ¦',81:'ğŸŒ§',82:'â›ˆ',85:'ğŸŒ¨',86:'â„ï¸',95:'â›ˆ',96:'â›ˆ',99:'â›ˆ'};

/* â”€â”€â”€ AQI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const AQI_INFO = [
  {max:50,  label:'Good',               color:'#22c55e', health:'Air quality is satisfactory.'},
  {max:100, label:'Moderate',           color:'#eab308', health:'Acceptable; may concern sensitive groups.'},
  {max:150, label:'Unhealthy for Some', color:'#f97316', health:'Sensitive groups: limit outdoor activity.'},
  {max:200, label:'Unhealthy',          color:'#ef4444', health:'Everyone may experience health effects.'},
  {max:300, label:'Very Unhealthy',     color:'#a855f7', health:'Health alert: serious effects for all.'},
  {max:500, label:'Hazardous',          color:'#9f1239', health:'Emergency: entire population at risk.'},
];
function getAQIInfo(v){ return AQI_INFO.find(a=>v<=a.max)||AQI_INFO[AQI_INFO.length-1]; }
function aqiFromPM25(pm25){
  const bp=[[0,12,0,50],[12.1,35.4,51,100],[35.5,55.4,101,150],[55.5,150.4,151,200],[150.5,250.4,201,300],[250.5,350.4,301,400],[350.5,500.4,401,500]];
  for(const[lo,hi,ilo,ihi] of bp) if(pm25>=lo&&pm25<=hi) return Math.round(((ihi-ilo)/(hi-lo))*(pm25-lo)+ilo);
  return 500;
}

/* â”€â”€â”€ Demo Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function demoTimes(n){ return Array.from({length:n},(_,i)=>{const d=new Date();d.setMinutes(0,0,0);d.setHours(d.getHours()+i);return d.toISOString().slice(0,16);}); }
function demoDates(n){ return Array.from({length:n},(_,i)=>{const d=new Date();d.setDate(d.getDate()+i);return d.toISOString().slice(0,10);}); }
const DEMO = {
  w:{
    current:{temperature_2m:30,apparent_temperature:34,relative_humidity_2m:76,wind_speed_10m:14,weathercode:2,uv_index:7.2},
    hourly:{
      time:demoTimes(48),
      temperature_2m:[30,29,28,27,26,25,25,26,28,30,32,33,34,34,33,32,31,30,29,28,28,27,26,25,24,24,23,24,26,28,31,33,35,34,33,31,30,29,28,27,27,26,25,24,23,23,24,25],
      weathercode:[2,2,1,1,0,0,0,1,2,2,3,3,2,2,2,1,1,2,80,80,1,0,0,0,0,0,1,1,2,2,3,80,80,2,2,2,1,1,2,2,1,0,0,0,0,0,0,1],
      precipitation:[0,0,0,0,0,0,0,0,0,0,0.1,0.4,1.2,0.9,0.3,0,0,0,2.1,3.4,0.5,0,0,0,0,0,0,0,0.1,0.3,1.0,2.8,4.1,0.8,0.2,0,0,0,0,0,0,0,0,0,0,0,0,0],
      precipitation_probability:[10,5,5,0,0,0,0,5,10,15,25,35,45,40,30,15,10,15,60,75,35,5,0,0,0,0,5,10,20,35,55,75,80,45,25,10,10,5,5,10,5,0,0,0,0,0,0,5]
    },
    daily:{
      time:demoDates(7),
      weathercode:[2,80,61,63,2,1,0],
      temperature_2m_max:[34,31,28,27,30,32,35],
      temperature_2m_min:[25,23,22,21,22,23,25],
      precipitation_sum:[1.2,12.4,24.8,18.2,2.1,0,0],
      precipitation_probability_max:[30,70,90,85,35,10,5]
    }
  },
  aq:{
    current:{pm2_5:52.3,pm10:78.1,nitrogen_dioxide:34.4,ozone:58.2,sulphur_dioxide:9.1,carbon_monoxide:620},
    hourly:{
      time:demoTimes(48),
      pm2_5:[52,54,56,59,62,64,61,57,53,48,44,40,38,36,38,40,44,48,52,56,54,50,46,43,40,38,36,35,38,43,50,58,65,61,55,50,47,44,42,39,37,35,33,32,31,30,31,33]
    }
  }
};

/* â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _chartData = {};
let _currentChartKey = 'rain24';

/* â”€â”€â”€ Theme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const THEME_COLORS = {dark:'#0a0f1e', light:'#f0f4fb', oled:'#000000'};
function setTheme(t){
  document.documentElement.setAttribute('data-theme', t);
  document.querySelectorAll('.theme-btn').forEach((b,i)=>{
    b.classList.toggle('active',['light','dark','oled'][i]===t);
  });
  const meta = document.getElementById('themeColorMeta');
  if(meta) meta.setAttribute('content', THEME_COLORS[t]||'#0a0f1e');
  try{ localStorage.setItem('atmos-theme',t); }catch(e){}
}
(function(){
  let s='dark';
  try{ s=localStorage.getItem('atmos-theme')||'dark'; }catch(e){}
  setTheme(s);
})();

/* â”€â”€â”€ Footer year â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('footYear').textContent = new Date().getFullYear();

/* â”€â”€â”€ Bottom nav tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _activeTab = 'weather';
function switchTab(tab){
  _activeTab = tab;
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  const sec = document.getElementById('sec-'+tab);
  const btn = document.getElementById('nav-'+tab);
  if(sec) sec.classList.add('active');
  if(btn) btn.classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
}

/* â”€â”€â”€ Demo Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showDemoBanner(){
  if(document.getElementById('demoBanner')) return;
  const b = document.createElement('div');
  b.id='demoBanner'; b.className='demo-banner';
  b.innerHTML='&#9889; Live API unavailable in preview â€” showing demo data. Download and open locally for real data.';
  document.getElementById('app').insertAdjacentElement('afterbegin', b);
}

/* â”€â”€â”€ Fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function fetchWeather(lat, lon, cityLabel){
  setStatus('<span class="loader"></span> Fetching weather...');
  try{
    const t = new Promise((_,rej)=>setTimeout(()=>rej(new Error('timeout')),8000));
    const [wRes,aqRes] = await Promise.race([
      Promise.all([
        fetch('https://api.open-meteo.com/v1/forecast?latitude='+lat+'&longitude='+lon
          +'&current=temperature_2m,apparent_temperature,relative_humidity_2m,wind_speed_10m,weathercode,uv_index'
          +'&hourly=temperature_2m,weathercode,precipitation,precipitation_probability'
          +'&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max'
          +'&timezone=auto&forecast_days=7&wind_speed_unit=kmh'),
        fetch('https://air-quality-api.open-meteo.com/v1/air-quality?latitude='+lat+'&longitude='+lon
          +'&current=pm2_5,pm10,carbon_monoxide,nitrogen_dioxide,ozone,sulphur_dioxide'
          +'&hourly=pm2_5&timezone=auto')
      ]),
      t
    ]);
    const [wData,aqData] = await Promise.all([wRes.json(), aqRes.json()]);
    if(wData.error) throw new Error(wData.reason||'API error');
    renderApp(wData, aqData, cityLabel);
    hideStatus();
  }catch(e){
    console.warn('Demo fallback:', e.message);
    renderApp(DEMO.w, DEMO.aq, cityLabel);
    hideStatus();
    showDemoBanner();
  }
}

/* â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderApp(w, aq, label){
  const c=w.current, d=w.daily, h=w.hourly;
  const DAYS=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

  // Location
  document.getElementById('locName').textContent = label;
  document.getElementById('locTime').textContent = new Date().toLocaleString('en-US',{weekday:'short',month:'short',day:'numeric',hour:'numeric',minute:'2-digit',hour12:true});

  // Weather
  const temp=Math.round(c.temperature_2m), feelsLike=Math.round(c.apparent_temperature);
  const humidity=c.relative_humidity_2m, wind=Math.round(c.wind_speed_10m), uv=c.uv_index??0;
  document.getElementById('tempBig').textContent=temp+'Â°C';
  document.getElementById('wIcon').textContent=WMO_ICON[c.weathercode]||'ğŸŒ¤';
  document.getElementById('wDesc').textContent=WMO[c.weathercode]||'â€”';
  document.getElementById('feelsLike').textContent=feelsLike+'Â°C';
  document.getElementById('humidity').textContent=humidity+'%';
  document.getElementById('wind').textContent=wind+' km/h';
  document.getElementById('uv').textContent=uv.toFixed(1);

  // AQI
  const pm25=aq.current?.pm2_5??0;
  const aqi=aqiFromPM25(pm25), info=getAQIInfo(aqi);
  document.getElementById('aqiVal').textContent=aqi;
  document.getElementById('aqiVal').style.color=info.color;
  const lbl=document.getElementById('aqiLabel');
  lbl.textContent=info.label; lbl.style.background=info.color+'22'; lbl.style.color=info.color;
  document.getElementById('aqiHealthMsg').textContent=info.health;
  setTimeout(()=>{ document.getElementById('aqiThumb').style.left=Math.min((aqi/500)*100,97)+'%'; },120);

  // Pollutants
  const polls=[
    {name:'PM2.5',val:aq.current?.pm2_5,unit:'Î¼g/mÂ³',max:150},
    {name:'PM10', val:aq.current?.pm10,  unit:'Î¼g/mÂ³',max:300},
    {name:'NOâ‚‚',  val:aq.current?.nitrogen_dioxide,unit:'Î¼g/mÂ³',max:200},
    {name:'Oâ‚ƒ',   val:aq.current?.ozone,unit:'Î¼g/mÂ³',max:240},
    {name:'SOâ‚‚',  val:aq.current?.sulphur_dioxide,unit:'Î¼g/mÂ³',max:500},
    {name:'CO',   val:aq.current?.carbon_monoxide?aq.current.carbon_monoxide/1000:null,unit:'mg/mÂ³',max:30},
  ];
  document.getElementById('pollGrid').innerHTML=polls.map(p=>{
    const v=p.val!=null?p.val.toFixed(1):'â€”';
    const pct=p.val!=null?Math.min((p.val/p.max)*100,100):0;
    return`<div class="poll-item"><div class="poll-name">${p.name}</div><div class="poll-val">${v}<span style="font-size:0.6rem;color:var(--text3);font-weight:500"> ${p.unit}</span></div><div class="poll-bar-mini"><div class="poll-bar-fill" style="width:${pct}%"></div></div></div>`;
  }).join('');

  // Hourly index
  const now=new Date();
  let si=h.time.findIndex(t=>new Date(t)>=now); if(si<0) si=0;
  const h24=h.time.slice(si,si+24);
  const precArr=h.precipitation||[];
  const probArr=h.precipitation_probability||[];

  // Rain Summary
  const rain24=precArr.slice(si,si+24).reduce((a,b)=>a+(b||0),0);
  const rainToday=d.precipitation_sum?(d.precipitation_sum[0]||0):rain24;
  const weekTotal=d.precipitation_sum?d.precipitation_sum.reduce((a,b)=>a+(b||0),0):0;
  const maxRain=d.precipitation_sum?Math.max(...d.precipitation_sum):0;
  const rainChance24=Math.max(...probArr.slice(si,si+24),0);
  document.getElementById('rainSummary').innerHTML=`
    <div class="rain-stat"><div class="rs-label">Next 24h</div><div class="rs-val">${rain24.toFixed(1)}<span class="rs-unit"> mm</span></div></div>
    <div class="rain-stat"><div class="rs-label">Today Total</div><div class="rs-val">${rainToday.toFixed(1)}<span class="rs-unit"> mm</span></div></div>
    <div class="rain-stat"><div class="rs-label">Week Total</div><div class="rs-val">${weekTotal.toFixed(1)}<span class="rs-unit"> mm</span></div></div>
    <div class="rain-stat"><div class="rs-label">Heaviest Day</div><div class="rs-val">${maxRain.toFixed(1)}<span class="rs-unit"> mm</span></div></div>
    <div class="rain-stat"><div class="rs-label">Rain Chance</div><div class="rs-val">${rainChance24}<span class="rs-unit"> %</span></div></div>
  `;

  // 24h Hourly
  const hrPM25arr=aq.hourly?.pm2_5||[];
  document.getElementById('hourlyRow').innerHTML=h24.map((_,i)=>{
    const idx=si+i;
    const hr=new Date(h.time[idx]);
    const timeStr=i===0?'Now':hr.toLocaleTimeString('en-US',{hour:'numeric',hour12:true});
    const icon=WMO_ICON[h.weathercode[idx]]||'ğŸŒ¤';
    const t2=Math.round(h.temperature_2m[idx]);
    const prec=precArr[idx]||0, prob=probArr[idx]||0;
    const hrPM=hrPM25arr[idx]??pm25;
    const hrAQI=aqiFromPM25(hrPM), hrAQIInfo=getAQIInfo(hrAQI);
    const rainTxt=prec>0.05?prec.toFixed(1)+'mm':(prob>15?prob+'%':'â€”');
    return`<div class="hourly-item"><div class="hr-time">${timeStr}</div><div class="hr-icon">${icon}</div><div class="hr-temp">${t2}Â°</div><div class="hr-rain">${rainTxt}</div><div class="hr-aqi" style="color:${hrAQIInfo.color}">${hrAQI}</div></div>`;
  }).join('');

  // 7-Day Forecast
  const aqiEst=estimate7DayAQI(aqi);
  document.getElementById('forecastRow').innerHTML=d.time.map((dt,i)=>{
    const date=new Date(dt+'T00:00:00');
    const dayName=i===0?'Today':DAYS[date.getDay()];
    const icon=WMO_ICON[d.weathercode[i]]||'ğŸŒ¤';
    const rain=d.precipitation_sum?(d.precipitation_sum[i]||0).toFixed(1):'â€”';
    const dayAQI=aqiEst[i], dayAQIInfo=getAQIInfo(dayAQI);
    return`<div class="forecast-day ${i===0?'today':''}"><div class="fc-day">${dayName}</div><div class="fc-icon">${icon}</div><div class="fc-hi">${Math.round(d.temperature_2m_max[i])}Â°</div><div class="fc-lo">${Math.round(d.temperature_2m_min[i])}Â°</div><div class="fc-rain">ğŸ’§${rain}mm</div><div class="fc-aqi-dot" style="background:${dayAQIInfo.color}" title="AQI ~${dayAQI}"></div></div>`;
  }).join('');

  // Lifestyle
  document.getElementById('lifestyleGrid').innerHTML=getLifestyle(temp,feelsLike,humidity,wind,uv,aqi,rainChance24,rain24).map(l=>
    `<div class="lf-card"><div class="lf-icon">${l.icon}</div><div class="lf-label">${l.label}</div><div class="lf-value">${l.value}</div><div class="lf-sub">${l.sub}</div></div>`
  ).join('');

  // Charts
  const h24Labels=h24.map((_,i)=>{const hr=new Date(h.time[si+i]);return i===0?'Now':hr.toLocaleTimeString('en-US',{hour:'numeric',hour12:true});});
  _chartData={
    rain24:{labels:h24Labels,values:h24.map((_,i)=>precArr[si+i]||0),color:'#38bdf8',unit:'mm'},
    aqi24: {labels:h24Labels,values:h24.map((_,i)=>aqiFromPM25(hrPM25arr[si+i]??pm25)),colorFn:v=>getAQIInfo(v).color,unit:'AQI'},
    rain7: {labels:d.time.map((dt,i)=>{const dt2=new Date(dt+'T00:00:00');return i===0?'Today':DAYS[dt2.getDay()];}),values:d.precipitation_sum?d.precipitation_sum.map(v=>v||0):Array(7).fill(0),color:'#38bdf8',unit:'mm'},
    aqi7:  {labels:d.time.map((dt,i)=>{const dt2=new Date(dt+'T00:00:00');return i===0?'Today':DAYS[dt2.getDay()];}),values:aqiEst,colorFn:v=>getAQIInfo(v).color,unit:'AQI'}
  };
  showChart(_currentChartKey);

  document.getElementById('app').style.display='block';
  // restore active section
  switchTab(_activeTab);
}

/* â”€â”€â”€ Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showChart(key){
  _currentChartKey=key;
  document.querySelectorAll('.tab-btn').forEach((b,i)=>{
    b.classList.toggle('active',['rain24','aqi24','rain7','aqi7'][i]===key);
  });
  const data=_chartData[key]; if(!data) return;
  const vals=data.values, maxVal=Math.max(...vals,0.1);
  document.getElementById('chartBars').innerHTML=vals.map((v,i)=>{
    const hPct=Math.max((v/maxVal)*100,2);
    const color=data.colorFn?data.colorFn(v):data.color;
    const disp=data.unit==='AQI'?Math.round(v):v.toFixed(1);
    return`<div class="bar-col"><div class="bar-val" style="color:${color}">${disp}</div><div class="bar-fill" style="height:${hPct}%;background:${color};opacity:0.82"></div><div class="bar-label">${data.labels[i]}</div></div>`;
  }).join('');
}

/* â”€â”€â”€ Lifestyle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getLifestyle(temp,feelsLike,humidity,wind,uv,aqi,rainChance,rain24){
  const items=[];
  if(feelsLike>=35||(feelsLike>=30&&humidity>75)) items.push({icon:'â„ï¸',label:'AC',value:'Strongly Recommended',sub:'Heat index critical â€” set AC to 24Â°C'});
  else if(feelsLike>=28&&humidity>65)             items.push({icon:'â„ï¸',label:'AC',value:'Recommended',sub:'Feels '+feelsLike+'Â°C â€” set AC to 25â€“26Â°C'});
  else if(feelsLike>=25)                          items.push({icon:'ğŸŒ€',label:'Fan',value:'Sufficient',sub:'Feels '+feelsLike+'Â°C â€” a fan provides comfort'});
  else                                            items.push({icon:'ğŸŒ¿',label:'Ventilation',value:'No Cooling Needed',sub:'Feels '+feelsLike+'Â°C â€” naturally comfortable'});
  if(rain24>10||rainChance>70)     items.push({icon:'â˜‚ï¸',label:'Umbrella',value:'Essential',sub:rainChance+'% rain, '+rain24.toFixed(1)+'mm expected'});
  else if(rain24>2||rainChance>40) items.push({icon:'ğŸŒ‚',label:'Umbrella',value:'Advisable',sub:rainChance+'% chance â€” carry one just in case'});
  else                             items.push({icon:'ğŸŒ',label:'Umbrella',value:'Not Needed',sub:'Only '+rainChance+'% rain chance today'});
  if(aqi>200)          items.push({icon:'ğŸ ',label:'Outdoors',value:'Stay Indoors',sub:'Hazardous air â€” avoid going outside'});
  else if(aqi>100)     items.push({icon:'ğŸ˜·',label:'Outdoors',value:'Limit Time',sub:'Wear a mask if going outside'});
  else if(rainChance>75)items.push({icon:'ğŸ ',label:'Outdoors',value:'Heavy Rain Likely',sub:'Plan indoor activities today'});
  else                 items.push({icon:'ğŸƒ',label:'Outdoors',value:'Good to Go',sub:'Conditions are suitable for outdoor activity'});
  if(uv>=8)      items.push({icon:'ğŸ•¶ï¸',label:'Sun Protection',value:'Very High UV '+uv.toFixed(0),sub:'SPF 50+, hat & shade essential 10amâ€“4pm'});
  else if(uv>=5) items.push({icon:'ğŸ§´',label:'Sun Protection',value:'High UV '+uv.toFixed(0),sub:'Apply SPF 30+ â€” reapply every 2 hours'});
  else if(uv>=3) items.push({icon:'ğŸ˜',label:'Sun Protection',value:'Moderate UV '+uv.toFixed(0),sub:'Sunscreen recommended if out for long'});
  else           items.push({icon:'ğŸŒ¤',label:'Sun Protection',value:'Low UV '+uv.toFixed(0),sub:'Minimal protection needed today'});
  if(aqi>200)      items.push({icon:'ğŸ˜·',label:'Face Mask',value:'N95 Required',sub:'Hazardous air â€” N95/KN95 is essential'});
  else if(aqi>100) items.push({icon:'ğŸ˜·',label:'Face Mask',value:'Recommended',sub:'Consider a mask for outdoor exposure'});
  else             items.push({icon:'âœ…',label:'Face Mask',value:'Optional',sub:'AQI '+aqi+' â€” air quality is acceptable'});
  if(feelsLike>=36)      items.push({icon:'ğŸ’§',label:'Hydration',value:'Drink Frequently',sub:'Heat stress risk â€” 3.5+ litres today'});
  else if(feelsLike>=29) items.push({icon:'ğŸ’§',label:'Hydration',value:'Stay Hydrated',sub:'Drink 2.5â€“3 litres throughout the day'});
  else                   items.push({icon:'ğŸ¥¤',label:'Hydration',value:'Normal Intake',sub:'Regular 1.5â€“2 litres is sufficient'});
  return items;
}

function estimate7DayAQI(aqi){
  return [1,1.06,0.97,1.12,0.91,0.86,0.94].map(f=>Math.min(500,Math.max(1,Math.round(aqi*f))));
}

/* â”€â”€â”€ Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function setStatus(html){
  document.getElementById('statusMsg').classList.add('visible');
  document.getElementById('statusText').innerHTML=html;
  document.getElementById('app').style.display='none';
}
function hideStatus(){
  document.getElementById('statusMsg').classList.remove('visible');
}

/* â”€â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function searchCity(){
  const city=document.getElementById('cityInput').value.trim();
  if(!city) return;
  setStatus('<span class="loader"></span> Searching for "'+city+'"...');
  try{
    const res=await fetch('https://geocoding-api.open-meteo.com/v1/search?name='+encodeURIComponent(city)+'&count=1');
    const data=await res.json();
    if(!data.results?.length){setStatus('<span class="error">City not found. Please try another name.</span>');return;}
    const r=data.results[0];
    fetchWeather(r.latitude,r.longitude,r.name+(r.admin1?', '+r.admin1:'')+', '+r.country);
  }catch(e){setStatus('<span class="error">Search failed. Please check your connection.</span>');}
}

/* â”€â”€â”€ Geolocation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getLocation(){
  if(!navigator.geolocation){setStatus('<span class="error">Geolocation not supported by your browser.</span>');return;}
  setStatus('<span class="loader"></span> Getting your location...');
  navigator.geolocation.getCurrentPosition(async pos=>{
    const{latitude:lat,longitude:lon}=pos.coords;
    try{
      const res=await fetch('https://nominatim.openstreetmap.org/reverse?lat='+lat+'&lon='+lon+'&format=json');
      const data=await res.json();
      const city=data.address?.city||data.address?.town||data.address?.village||lat.toFixed(2)+', '+lon.toFixed(2);
      fetchWeather(lat,lon,city+', '+(data.address?.country||''));
    }catch{fetchWeather(lat,lon,lat.toFixed(2)+'Â°N, '+lon.toFixed(2)+'Â°E');}
  },()=>setStatus('<span class="error">Location access denied. Please search manually.</span>'));
}

/* â”€â”€â”€ Keyboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('cityInput').addEventListener('keydown',e=>{ if(e.key==='Enter') searchCity(); });

/* â”€â”€â”€ Auto-load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
fetchWeather(22.5726, 88.3639, 'Kolkata, West Bengal, India');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PWA â€” MANIFEST + SERVICE WORKER (inline / blob)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Generate SVG icon as data URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function makeIconDataURL(size) {
  const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
    <defs>
      <linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#38bdf8"/>
        <stop offset="100%" stop-color="#818cf8"/>
      </linearGradient>
    </defs>
    <rect width="${size}" height="${size}" rx="${size*0.22}" fill="#0a0f1e"/>
    <rect width="${size}" height="${size}" rx="${size*0.22}" fill="url(#g1)" opacity="0.15"/>
    <!-- Sun -->
    <circle cx="${size*0.38}" cy="${size*0.36}" r="${size*0.13}" fill="#fbbf24"/>
    <!-- Cloud -->
    <ellipse cx="${size*0.55}" cy="${size*0.52}" rx="${size*0.22}" ry="${size*0.14}" fill="url(#g1)" opacity="0.9"/>
    <ellipse cx="${size*0.42}" cy="${size*0.55}" rx="${size*0.15}" ry="${size*0.11}" fill="url(#g1)" opacity="0.9"/>
    <ellipse cx="${size*0.66}" cy="${size*0.56}" rx="${size*0.12}" ry="${size*0.09}" fill="url(#g1)" opacity="0.85"/>
    <!-- Rain drops -->
    <line x1="${size*0.44}" y1="${size*0.69}" x2="${size*0.41}" y2="${size*0.78}" stroke="#38bdf8" stroke-width="${size*0.03}" stroke-linecap="round"/>
    <line x1="${size*0.55}" y1="${size*0.72}" x2="${size*0.52}" y2="${size*0.81}" stroke="#38bdf8" stroke-width="${size*0.03}" stroke-linecap="round"/>
    <line x1="${size*0.66}" y1="${size*0.69}" x2="${size*0.63}" y2="${size*0.78}" stroke="#38bdf8" stroke-width="${size*0.03}" stroke-linecap="round"/>
  </svg>`;
  return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
}

/* â”€â”€ Inject manifest as blob URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
(function injectManifest() {
  const icon192 = makeIconDataURL(192);
  const icon512 = makeIconDataURL(512);

  const manifest = {
    name: 'Atmos â€” Weather & Air Quality',
    short_name: 'Atmos',
    description: 'Real-time weather, AQI, rain & lifestyle recommendations.',
    start_url: './',
    display: 'standalone',
    background_color: '#0a0f1e',
    theme_color: '#0a0f1e',
    orientation: 'portrait-primary',
    categories: ['weather', 'lifestyle'],
    lang: 'en',
    icons: [
      { src: icon192, sizes: '192x192', type: 'image/svg+xml', purpose: 'any maskable' },
      { src: icon512, sizes: '512x512', type: 'image/svg+xml', purpose: 'any maskable' }
    ],
    shortcuts: [
      { name: 'Check Weather', short_name: 'Weather', description: 'See current conditions', url: './', icons: [{ src: icon192, sizes: '192x192' }] }
    ]
  };

  const blob = new Blob([JSON.stringify(manifest)], { type: 'application/manifest+json' });
  const blobURL = URL.createObjectURL(blob);

  const manifestLink = document.getElementById('pwaManifest');
  if (manifestLink) manifestLink.href = blobURL;

  // Apple touch icon
  const icon = makeIconDataURL(180);
  const appleLink = document.getElementById('appleTouchIcon');
  if (appleLink) appleLink.href = icon;
  const faviconLink = document.getElementById('faviconLink');
  if (faviconLink) faviconLink.href = makeIconDataURL(32);
})();

/* â”€â”€ Register Service Worker (blob) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
(function registerSW() {
  if (!('serviceWorker' in navigator)) return;

  const CACHE = 'atmos-v1';
  const ASSETS = ['./', './index.html'];

  const swCode = `
const CACHE = '${CACHE}';
const ASSETS = ${JSON.stringify(ASSETS)};

self.addEventListener('install', e => {
  e.waitUntil(
    caches.open(CACHE).then(cache => cache.addAll(ASSETS)).then(() => self.skipWaiting())
  );
});

self.addEventListener('activate', e => {
  e.waitUntil(
    caches.keys().then(keys =>
      Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k)))
    ).then(() => self.clients.claim())
  );
});

self.addEventListener('fetch', e => {
  const url = new URL(e.request.url);

  // For API requests: network-first, fallback to cache
  if (url.hostname.includes('open-meteo.com') || url.hostname.includes('nominatim')) {
    e.respondWith(
      fetch(e.request)
        .then(res => {
          const clone = res.clone();
          caches.open(CACHE).then(cache => cache.put(e.request, clone));
          return res;
        })
        .catch(() => caches.match(e.request))
    );
    return;
  }

  // For Google Fonts: network-first, no cache required
  if (url.hostname.includes('fonts.google') || url.hostname.includes('fonts.gstatic')) {
    e.respondWith(
      fetch(e.request).catch(() => new Response('', { status: 408 }))
    );
    return;
  }

  // For app shell: cache-first
  e.respondWith(
    caches.match(e.request).then(cached => cached || fetch(e.request).then(res => {
      if (res.ok) {
        caches.open(CACHE).then(cache => cache.put(e.request, res.clone()));
      }
      return res;
    }))
  );
});

// Background sync: notify clients when back online
self.addEventListener('message', e => {
  if (e.data === 'skipWaiting') self.skipWaiting();
});
`;

  const swBlob = new Blob([swCode], { type: 'application/javascript' });
  const swURL = URL.createObjectURL(swBlob);

  navigator.serviceWorker.register(swURL, { scope: './' })
    .then(reg => {
      console.log('[Atmos SW] Registered:', reg.scope);
      // Check for updates every 60s
      setInterval(() => reg.update(), 60000);
    })
    .catch(err => console.warn('[Atmos SW] Registration failed:', err));

  // Detect online/offline
  function updateOnlineStatus() {
    const isOnline = navigator.onLine;
    let banner = document.getElementById('offlineBanner');
    if (!isOnline) {
      if (!banner) {
        banner = document.createElement('div');
        banner.id = 'offlineBanner';
        banner.style.cssText = [
          'position:fixed','top:0','left:0','right:0','z-index:9999',
          'background:#ef4444','color:#fff','text-align:center',
          'padding:0.5rem 1rem','font-size:0.82rem','font-weight:700',
          'font-family:var(--font-body)','letter-spacing:0.02em'
        ].join(';');
        banner.textContent = 'ğŸ“¡ You are offline â€” showing cached data';
        document.body.prepend(banner);
      }
    } else {
      if (banner) { banner.remove(); }
    }
  }
  window.addEventListener('online',  updateOnlineStatus);
  window.addEventListener('offline', updateOnlineStatus);
  updateOnlineStatus();
})();

/* â”€â”€ Install prompt (Add to Home Screen) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
(function installPrompt() {
  let deferredPrompt = null;

  window.addEventListener('beforeinstallprompt', e => {
    e.preventDefault();
    deferredPrompt = e;

    // Show install button if not already installed
    if (!window.matchMedia('(display-mode: standalone)').matches) {
      showInstallBanner();
    }
  });

  function showInstallBanner() {
    if (document.getElementById('installBanner')) return;
    const banner = document.createElement('div');
    banner.id = 'installBanner';
    banner.style.cssText = [
      'position:fixed','bottom:calc(68px + env(safe-area-inset-bottom, 0px) + 8px)',
      'left:50%','transform:translateX(-50%)',
      'background:linear-gradient(135deg,#38bdf8,#818cf8)',
      'color:#fff','border-radius:100px',
      'padding:0.6rem 1.4rem','font-size:0.82rem','font-weight:700',
      'cursor:pointer','z-index:300','box-shadow:0 4px 20px rgba(56,189,248,0.45)',
      'white-space:nowrap','display:flex','align-items:center','gap:0.5rem',
      'font-family:var(--font-body)','border:none','outline:none',
      'animation:fadeUp 0.4s ease'
    ].join(';');
    banner.innerHTML = '&#8681; Add Atmos to Home Screen';

    banner.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log('[Atmos PWA] Install outcome:', outcome);
      deferredPrompt = null;
      banner.remove();
    });

    document.body.appendChild(banner);

    // Auto-hide after 8s
    setTimeout(() => { if (banner.parentNode) banner.remove(); }, 8000);
  }

  // Hide banner once installed
  window.addEventListener('appinstalled', () => {
    const banner = document.getElementById('installBanner');
    if (banner) banner.remove();
    console.log('[Atmos PWA] App installed!');
  });
})();
</script>
</body>
</html>